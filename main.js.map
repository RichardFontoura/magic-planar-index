{
  "version": 3,
  "sources": ["../src/utils/helpers.ts", "../src/app/core/services/plane-flags.service.ts", "../src/app/shared/services/socket/types/werewolf-socket.types.ts", "../src/app/shared/services/socket/domain/werewolf-socket.service.ts", "../src/main.ts", "../src/app/core/services/register.service.ts", "../src/app/features/planar-layout-editor/PlanarLayoutEditor.ts", "../src/app/shared/features/base/domain/base-form.ts", "../src/app/core/net/refresh-bus.ts", "../src/app/core/services/planar-layout.service.ts", "../src/app/core/data/planar-layout.ts", "../src/app/core/services/sheet-buttons.service.ts", "../src/app/features/planar-index/PlanarIndex.ts", "../src/app/features/planar-index/gm-planar-rpc.ts"],
  "sourcesContent": ["export class HandlebarsApplication extends foundry.applications.api.HandlebarsApplicationMixin(foundry.applications.api.ApplicationV2) {}\n\nexport const MODULE_ID = \"magic-planar-index\";\n\nexport const { DialogV2 } = foundry.applications.api;\n\nexport const { duplicate } = foundry.utils;\n\nexport const FilePicker = (foundry.applications.apps as any).FilePicker.implementation;\n\nexport const notify = {\n  info(msg: string): void {\n    void ui?.notifications?.info(msg);\n  },\n  error(msg: string): void {\n    void ui?.notifications?.error(msg);\n  },\n  success(msg: string): void {\n    void ui?.notifications?.success(msg);\n  },\n  warn(msg: string): void {\n    void ui?.notifications?.warn(msg);\n  },\n};\n\nexport function mergeObject(obj: object, source: object) {\n  return foundry.utils.mergeObject(obj, source);\n}\n\nexport function randomID(length = 16) {\n  return foundry.utils.randomID(length);\n}\n\nexport function getAppId(className: string): string {\n  return className\n    .replace(/([a-z0-9])([A-Z])/g, \"$1-$2\")\n    .toLowerCase()\n    .replace(/^_+/, \"\");\n}\n\nexport function i18nLocalize(key: string, fallback: string = \"\"): string {\n  return (game as Game).i18n?.localize(`${MODULE_ID}.${key}`) ?? fallback;\n}\n\nexport function i18nLocalizeFormat(key: string, format: Record<string, string>, fallback: string = \"\"): string {\n  return (game as Game).i18n?.format(`${MODULE_ID}.${key}`, format) ?? fallback;\n}\n\nexport function getModule(_module: string = MODULE_ID) {\n  const module = (game as Game).modules?.get(_module);\n  if (!module) {\n    throw new Error(`Module ${_module} not found`);\n  }\n  return module;\n}\n\nexport function getModuleApi<TApi = unknown>(_module: string = MODULE_ID): TApi | undefined {\n  const module = getModule(_module) as unknown as { api?: TApi };\n  return module.api;\n}\n\nexport function registerHandlebarsHelpers() {\n  try {\n    const hb = (globalThis as any).Handlebars;\n    if (!hb) {\n      console.warn(\"[planar-index] Handlebars not found to register helpers.\");\n      return;\n    }\n\n    if (!hb.helpers?.truncate) {\n      hb.registerHelper(\"truncate\", (text: any, max: any) => {\n        const limit = Number(max) || 100;\n        if (text == null) return \"\";\n        const s = String(text);\n        if (s.length <= limit) return s;\n        return `${s.slice(0, limit).trimEnd()}\u2026`;\n      });\n    }\n  } catch (err) {\n    console.error(\"[planar-index] Failed to register Handlebars helpers:\", err);\n  }\n}\n\nexport function getActiveGmId(): string | undefined {\n  const active = game.users?.find(u => u.active && u.isGM)?.id;\n  if (active) return active;\n  return game.users?.find(u => u.isGM)?.id;\n}\n\nexport function requireGmOrThrow() {\n  if (!game.user?.isGM) throw new Error(\"Only the GM can perform this operation.\");\n}\n", "import { MODULE_ID, getActiveGmId, getModuleApi } from \"@helpers\";\nimport type { ActorPlaneFlags } from \"../types/plane.types\";\n\nconst FLAG_KEY = \"planes\";\nconst FLAG_META_KEY = \"planesMeta\";\n\n/**\n * Get an actor's plane flags\n */\nexport function getActorPlanes(actor: Actor): Record<string, boolean> {\n  const flags = actor.getFlag(MODULE_ID, FLAG_KEY) as Record<string, boolean> | undefined;\n  return flags ?? {};\n}\n\n/**\n * Get an actor's plane metadata\n */\nexport function getActorPlanesMeta(actor: Actor): { lastUpdatedBy?: string; lastUpdatedAt?: number } {\n  const meta = actor.getFlag(MODULE_ID, FLAG_META_KEY) as { lastUpdatedBy?: string; lastUpdatedAt?: number } | undefined;\n  return meta ?? {};\n}\n\n/**\n * Check if a specific plane is enabled for an actor\n */\nexport function isPlaneEnabled(actor: Actor, planeId: string): boolean {\n  const planes = getActorPlanes(actor);\n  return planes[planeId] === true;\n}\n\n/**\n * Set an actor's planes (GM only - direct call)\n * This should only be called by the GM\n */\nexport async function setActorPlanes(actor: Actor, planes: Record<string, boolean>, userId?: string): Promise<void> {\n  await actor.setFlag(MODULE_ID, FLAG_KEY, planes);\n  await actor.setFlag(MODULE_ID, FLAG_META_KEY, {\n    lastUpdatedBy: userId ?? game.user?.id,\n    lastUpdatedAt: Date.now(),\n  });\n}\n\n/**\n * Toggle a single plane for an actor (GM only - direct call)\n */\nexport async function toggleActorPlane(actor: Actor, planeId: string, enabled: boolean, userId?: string): Promise<void> {\n  const planes = getActorPlanes(actor);\n  planes[planeId] = enabled;\n  await setActorPlanes(actor, planes, userId);\n}\n\n/**\n * Request to toggle a plane via GM RPC (for non-GM users)\n */\nexport async function requestTogglePlane(actorId: string, planeId: string, enabled: boolean): Promise<boolean> {\n  const moduleApi = getModuleApi() as ModuleAPI;\n  const ws = moduleApi.werewolfSocket;\n  const gmId = getActiveGmId();\n\n  if (!gmId) {\n    throw new Error(\"No GM available to process request\");\n  }\n\n  try {\n    const result = await ws.request<{ success: boolean }>(\n      \"pi:plane:toggle\",\n      { actorId, planeId, enabled },\n      { targetUserId: gmId, loopback: game.user?.isGM }\n    );\n    return result.success;\n  } catch (err) {\n    console.error(\"[planar-index] Failed to toggle plane via RPC:\", err);\n    return false;\n  }\n}\n\n/**\n * Count enabled planes for an actor\n */\nexport function countEnabledPlanes(actor: Actor, planeIds?: string[]): number {\n  const planes = getActorPlanes(actor);\n  if (!planeIds) return Object.values(planes).filter(Boolean).length;\n  return planeIds.reduce((count, id) => count + (planes[id] ? 1 : 0), 0);\n}\n\n/**\n * Get all enabled plane IDs for an actor\n */\nexport function getEnabledPlaneIds(actor: Actor): string[] {\n  const planes = getActorPlanes(actor);\n  return Object.entries(planes)\n    .filter(([, enabled]) => enabled)\n    .map(([id]) => id);\n}\n", "export type Envelope = {\n  type: string;\n  payload?: unknown;\n  sender: string;\n  targetUserId?: string;\n  requestId?: string;\n  response?: {\n    ok: boolean;\n    data?: unknown;\n    error?: string;\n  };\n};\n\nexport type Handler = (env: Envelope) => unknown | Promise<unknown>;\n\nexport type Middleware = (env: Envelope, next: () => Promise<void>) => Promise<void>;\n\nexport const isResponse = (e: Envelope): boolean => !!e.response && !!e.requestId;\n", "import { Envelope, Handler, Middleware, isResponse } from \"../types/werewolf-socket.types\";\nimport { MODULE_ID, randomID } from \"@helpers\";\n\nexport const CHANNEL = `module.${MODULE_ID}`;\n\nexport class WerewolfSocketService {\n  private socket?: Game[\"socket\"];\n  private rpcWaiters = new Map<string, (env: Envelope) => void>();\n  private boundHandler = (data: Envelope) => this.dispatch(data);\n\n  private readonly channel: string;\n  private readonly listeners = new Map<string, Set<Handler>>();\n  private readonly middlewares: Middleware[] = [];\n\n  constructor(channel: string) {\n    this.channel = channel;\n  }\n\n  init(): void {\n    this.socket = game.socket;\n    this.socket?.on(this.channel, this.boundHandler);\n  }\n\n  destroy(): void {\n    this.socket?.off(this.channel, this.boundHandler);\n    this.listeners.clear();\n    this.rpcWaiters.clear();\n  }\n\n  use(mw: Middleware): void {\n    this.middlewares.push(mw);\n  }\n\n  on(type: string, handler: Handler): () => void {\n    const set = this.listeners.get(type) ?? new Set<Handler>();\n    set.add(handler);\n    this.listeners.set(type, set);\n    return () => {\n      set.delete(handler);\n    };\n  }\n\n  off(type: string, handler: Handler) {\n    this.listeners.get(type)?.delete(handler);\n  }\n\n  emit(type: string, payload?: unknown, opts?: { targetUserId: string; loopback?: boolean }) {\n    const env: Envelope = {\n      type,\n      payload,\n      sender: game.user?.id ?? \"\",\n      targetUserId: opts?.targetUserId,\n    };\n    this.socket?.emit(this.channel, env);\n    if (opts?.loopback !== false) this.dispatch(env);\n  }\n\n  request<R = unknown>(type: string, payload?: unknown, opts?: { targetUserId?: string; timeoutMs?: number; loopback?: boolean }): Promise<R> {\n    const requestId = randomID();\n    const env: Envelope = {\n      type,\n      payload,\n      sender: game.user?.id ?? \"\",\n      targetUserId: opts?.targetUserId,\n      requestId,\n    };\n\n    const timeoutMs = opts?.timeoutMs ?? 10000;\n\n    return new Promise<R>((resolve, reject) => {\n      const handler = (responseEnv: Envelope) => {\n        if (responseEnv.requestId !== requestId || !responseEnv.response) return;\n        this.rpcWaiters.delete(requestId);\n        if (responseEnv.response.ok) resolve(responseEnv.response.data as R);\n        else reject(new Error(responseEnv.response.error ?? \"Socket RPC failed!\"));\n      };\n\n      this.rpcWaiters.set(requestId, handler);\n      this.socket?.on(this.channel, handler);\n\n      this.socket?.emit(this.channel, env);\n      if (opts?.loopback !== false) this.dispatch(env);\n\n      setTimeout(() => {\n        if (!this.rpcWaiters.has(requestId)) return;\n        this.socket?.off(this.channel, handler);\n        this.rpcWaiters.delete(requestId);\n        reject(new Error(\"Socket RPC timed out!\"));\n      }, timeoutMs);\n    });\n  }\n\n  private async dispatch(env: Envelope) {\n    if (env.targetUserId && env.targetUserId !== game.user?.id) return;\n\n    if (isResponse(env) && env.requestId) {\n      const waiter = this.rpcWaiters.get(env.requestId);\n      if (waiter) {\n        this.socket?.off(this.channel, waiter);\n        waiter(env);\n      }\n      return;\n    }\n\n    const chain = [...this.middlewares];\n    let idx = -1;\n    const run = async () => {\n      idx++;\n      if (idx < chain.length) {\n        await chain[idx](env, run);\n      } else {\n        const set = this.listeners.get(env.type);\n        if (!set || set.size === 0) return;\n        let answered = false;\n        for (const handler of set) {\n          const result = await handler(env);\n          if (env.requestId && result !== undefined && !answered) {\n            answered = true;\n            this.reply(env, { ok: true, data: result });\n          }\n        }\n        if (env.requestId && !answered) this.reply(env, { ok: true });\n      }\n    };\n    try {\n      await run();\n    } catch (err: any) {\n      if (env.requestId) this.reply(env, { ok: false, error: err?.message ?? String(err) });\n      else console.error(`[WerrewolfSocket] Error handling ${env.type}`);\n    }\n  }\n\n  private reply(to: Envelope, response: NonNullable<Envelope[\"response\"]>) {\n    const responseEnv: Envelope = {\n      type: to.type,\n      sender: game.user?.id || \"\",\n      targetUserId: to.sender,\n      requestId: to.requestId,\n      response,\n    };\n    this.socket?.emit(this.channel, responseEnv);\n    if (to.sender === game.user?.id) {\n      this.dispatch(responseEnv);\n    }\n  }\n}\n", "import { WerewolfSocketService, CHANNEL } from \"@socket/domain/werewolf-socket.service\";\nimport { getModule, registerHandlebarsHelpers } from \"@helpers\";\nimport { registerSettings } from \"app/core/services/register.service\";\nimport { registerSheetButtonHooks } from \"app/core/services/sheet-buttons.service\";\nimport { registerGmPlanarRpc } from \"app/features/planar-index/gm-planar-rpc\";\nimport { validatePlanarLayout } from \"app/core/data/planar-layout\";\n\nlet werewolfSocket: WerewolfSocketService;\n\nHooks.on(\"init\", () => {\n  // Initialize socket service\n  werewolfSocket = new WerewolfSocketService(CHANNEL);\n  werewolfSocket.init();\n\n  // Register Handlebars helpers\n  registerHandlebarsHelpers();\n\n  // Register custom Handlebars helper for multiplication (used in positioning)\n  const hb = (globalThis as any).Handlebars;\n  if (hb && !hb.helpers?.multiply) {\n    hb.registerHelper(\"multiply\", (a: number, b: number) => {\n      return (Number(a) || 0) * (Number(b) || 0);\n    });\n  }\n\n  // Register module settings\n  registerSettings();\n\n  // Export API\n  const module = getModule() as Module;\n  if (module) {\n    module.api = {\n      werewolfSocket,\n    };\n  }\n\n  // Validate planar layout (development sanity check)\n  const validation = validatePlanarLayout();\n  if (!validation.valid) {\n    console.error(\"[planar-index] Planar layout validation failed:\", validation.errors);\n  }\n\n  console.log(\"Magic Planar Index initialized\");\n});\n\nHooks.once(\"ready\", () => {\n  // Register GM RPC handlers\n  registerGmPlanarRpc();\n\n  // Register Actor sheet header button hooks\n  registerSheetButtonHooks();\n\n  console.log(\"Magic Planar Index ready\");\n});\n\n// Cleanup on page unload\nwindow.addEventListener(\"beforeunload\", () => {\n  werewolfSocket?.destroy();\n});\n", "import { MODULE_ID, i18nLocalize as l } from \"@helpers\";\nimport { PlanarLayoutEditor } from \"app/features/planar-layout-editor/PlanarLayoutEditor\";\nimport type { EditPermissionLevel } from \"../types/plane.types\";\n\n/**\n * Settings keys for the module\n */\nexport const SETTINGS_KEYS = {\n  EditPermission: \"editPermission\",\n  OwnedActorsOnly: \"ownedActorsOnly\",\n  CustomBackground: \"customBackground\",\n  PlanarIndexWindowSize: \"planarIndexWindowSize\",\n  CustomPlanarLayout: \"customPlanarLayout\",\n} as const;\n\nexport type PlanarIndexWindowSize = {\n  width: number;\n  height: number;\n};\n\nexport const PLANAR_INDEX_DEFAULT_SIZE: PlanarIndexWindowSize = {\n  width: 900,\n  height: 700,\n};\n\n/**\n * Register module settings\n */\nexport function registerSettings(): void {\n  const g = game as Game;\n\n  // Who can edit planes on actors\n  g.settings.register(MODULE_ID, SETTINGS_KEYS.EditPermission, {\n    name: l(\"settings.editPermission.name\"),\n    hint: l(\"settings.editPermission.hint\"),\n    scope: \"world\",\n    config: true,\n    type: String,\n    choices: {\n      gm: l(\"settings.editPermission.choices.gm\"),\n      trusted: l(\"settings.editPermission.choices.trusted\"),\n      all: l(\"settings.editPermission.choices.all\"),\n    },\n    default: \"gm\",\n    requiresReload: false,\n  });\n\n  // Restrict players to only editing their owned actors\n  g.settings.register(MODULE_ID, SETTINGS_KEYS.OwnedActorsOnly, {\n    name: l(\"settings.ownedActorsOnly.name\"),\n    hint: l(\"settings.ownedActorsOnly.hint\"),\n    scope: \"world\",\n    config: true,\n    type: Boolean,\n    default: true,\n    requiresReload: false,\n  });\n\n  // Custom background image URL (optional)\n  g.settings.register(MODULE_ID, SETTINGS_KEYS.CustomBackground, {\n    name: l(\"settings.customBackground.name\"),\n    hint: l(\"settings.customBackground.hint\"),\n    scope: \"world\",\n    config: true,\n    type: String,\n    default: \"\",\n    requiresReload: false,\n  });\n\n  // Planar Index window size (per-user)\n  g.settings.register(MODULE_ID, SETTINGS_KEYS.PlanarIndexWindowSize, {\n    name: l(\"settings.planarIndexWindowSize.name\"),\n    hint: l(\"settings.planarIndexWindowSize.hint\"),\n    scope: \"client\",\n    config: false,\n    type: Object,\n    default: { ...PLANAR_INDEX_DEFAULT_SIZE },\n    requiresReload: false,\n  });\n\n  // Custom planar layout data (GM-only)\n  g.settings.register(MODULE_ID, SETTINGS_KEYS.CustomPlanarLayout, {\n    name: l(\"settings.customPlanarLayout.name\"),\n    hint: l(\"settings.customPlanarLayout.hint\"),\n    scope: \"world\",\n    config: false,\n    default: null,\n    requiresReload: false,\n  });\n\n  g.settings.registerMenu(MODULE_ID, \"planarLayoutEditor\", {\n    name: l(\"settings.layoutEditorMenu.name\"),\n    label: l(\"settings.layoutEditorMenu.label\"),\n    hint: l(\"settings.layoutEditorMenu.hint\"),\n    icon: \"fa-solid fa-diagram-project\",\n    type: PlanarLayoutEditor,\n    restricted: true,\n  });\n}\n\n/**\n * Get the current edit permission level\n */\nexport function getEditPermission(): EditPermissionLevel {\n  const g = game as Game;\n  return g.settings.get(MODULE_ID, SETTINGS_KEYS.EditPermission) as EditPermissionLevel;\n}\n\n/**\n * Check if players can only edit owned actors\n */\nexport function getOwnedActorsOnly(): boolean {\n  const g = game as Game;\n  return g.settings.get(MODULE_ID, SETTINGS_KEYS.OwnedActorsOnly) as boolean;\n}\n\n/**\n * Get custom background URL if set\n */\nexport function getCustomBackground(): string {\n  const g = game as Game;\n  return g.settings.get(MODULE_ID, SETTINGS_KEYS.CustomBackground) as string;\n}\n\nexport function getPlanarIndexWindowSize(): PlanarIndexWindowSize {\n  const g = game as Game;\n  const value = g.settings.get(MODULE_ID, SETTINGS_KEYS.PlanarIndexWindowSize) as Partial<PlanarIndexWindowSize> | undefined;\n  if (!value || typeof value.width !== \"number\" || typeof value.height !== \"number\") {\n    return { ...PLANAR_INDEX_DEFAULT_SIZE };\n  }\n\n  return { width: value.width, height: value.height };\n}\n\nexport async function setPlanarIndexWindowSize(size: PlanarIndexWindowSize): Promise<void> {\n  const g = game as Game;\n  await g.settings.set(MODULE_ID, SETTINGS_KEYS.PlanarIndexWindowSize, size);\n}\n\n/**\n * Check if a user can edit planes on a specific actor\n */\nexport function canUserEditPlanes(user: User, actor: Actor): boolean {\n  // GM can always edit\n  if (user.isGM) return true;\n\n  const permission = getEditPermission();\n\n  // If permission is GM only, non-GMs cannot edit\n  if (permission === \"gm\") return false;\n\n  // If permission is trusted, check if user is trusted\n  if (permission === \"trusted\") {\n    const isTrusted = user.role >= CONST.USER_ROLES.TRUSTED;\n    if (!isTrusted) return false;\n  }\n\n  // If ownedActorsOnly is enabled, check ownership\n  if (getOwnedActorsOnly()) {\n    const isOwner = actor.testUserPermission(user, \"OWNER\");\n    if (!isOwner) return false;\n  }\n\n  return true;\n}\n", "import { DialogV2, MODULE_ID, i18nLocalize as l, i18nLocalizeFormat as lf, notify } from \"@helpers\";\nimport { BaseForm } from \"app/shared/features/base/domain/base-form\";\nimport { emitRefresh } from \"app/core/net/refresh-bus\";\nimport {\n  getCustomLayout,\n  getDefaultLayout,\n  getEffectiveLayout,\n  normalizePlaneId,\n  resetLayoutToDefault,\n  saveCustomLayout,\n  validateLayout,\n} from \"app/core/services/planar-layout.service\";\n\nimport type { DeepPartial } from \"fvtt-types/utils\";\nimport type { DefaultOptions, HandlebarsTemplatePart, AppV2RenderOptions, Context } from \"app/shared/features/base/types/base-form.types\";\nimport type { Plane, PlaneCategory } from \"app/core/types/plane.types\";\n\ntype SortMode = \"default\" | \"name\" | \"category\";\n\ninterface PlanarLayoutEditorContext extends Context {\n  planes: Array<Plane & { hidden: boolean; selected: boolean }>;\n  planeList: Array<Plane & { hidden: boolean; selected: boolean }>;\n  hasCustomLayout: boolean;\n  layoutStatusLabel: string;\n  searchPlaceholder: string;\n  sortOptions: Array<{ value: SortMode; label: string; selected: boolean }>;\n  isGm: boolean;\n}\n\ntype PlaneFormValues = {\n  name: string;\n  id: string;\n  category: PlaneCategory;\n  x: number;\n  y: number;\n  hidden: boolean;\n};\n\nexport class PlanarLayoutEditor extends BaseForm {\n  private layout: Plane[] = [];\n  private hasCustomLayout = false;\n  private needsReload = true;\n  private searchFilter = \"\";\n  private sortMode: SortMode = \"default\";\n  private selectedPlaneId?: string;\n\n  private zoomLevel = 1;\n  private panX = 0;\n  private panY = 0;\n  private readonly MIN_ZOOM = 0.5;\n  private readonly MAX_ZOOM = 2;\n  private isPanning = false;\n  private panStartClientX = 0;\n  private panStartClientY = 0;\n  private panStartX = 0;\n  private panStartY = 0;\n  private panMoved = false;\n\n  private isDraggingPlane = false;\n  private dragPlaneId?: string;\n  private dragPlaneNode?: HTMLElement;\n  private dragStartClientX = 0;\n  private dragStartClientY = 0;\n  private dragMoved = false;\n\n  override viewId(): string {\n    return \"planar-layout-editor\";\n  }\n\n  static override get DEFAULT_OPTIONS(): DefaultOptions {\n    const base = super.DEFAULT_OPTIONS;\n    return {\n      ...base,\n      id: \"planar-layout-editor\",\n      classes: [...(base.classes ?? []), \"planar-layout-editor\"],\n      window: {\n        ...base.window,\n        title: l(\"ui.layoutEditor.title\"),\n        icon: \"fa-solid fa-diagram-project\",\n        resizable: true,\n        minimizable: true,\n      },\n      position: {\n        ...base.position,\n        width: 1200,\n        height: 750,\n      },\n    };\n  }\n\n  static override get PARTS(): Record<string, HandlebarsTemplatePart> {\n    const base = super.PARTS;\n    return {\n      ...base,\n      content: {\n        ...base.content,\n        template: `modules/${MODULE_ID}/templates/planar-layout-editor/planar-layout-editor.hbs`,\n        classes: [\"planar-layout-editor-content\"],\n        scrollable: [],\n      },\n    };\n  }\n\n  override async _prepareContext(options: DeepPartial<AppV2RenderOptions> & { isFirstRender: boolean }): Promise<PlanarLayoutEditorContext> {\n    const isGm = game.user?.isGM ?? false;\n    if (this.needsReload || this.layout.length === 0) this.reloadLayoutFromSettings();\n\n    const planes = this.layout.map(plane => ({\n      ...plane,\n      hidden: plane.hidden === true,\n      selected: plane.id === this.selectedPlaneId,\n    }));\n\n    const planeList = this.getSortedPlaneList().map(plane => ({\n      ...plane,\n      hidden: plane.hidden === true,\n      selected: plane.id === this.selectedPlaneId,\n    }));\n\n    const sortOptions: PlanarLayoutEditorContext[\"sortOptions\"] = [\n      { value: \"default\", label: l(\"ui.layoutEditor.sort.default\"), selected: this.sortMode === \"default\" },\n      { value: \"name\", label: l(\"ui.layoutEditor.sort.name\"), selected: this.sortMode === \"name\" },\n      { value: \"category\", label: l(\"ui.layoutEditor.sort.category\"), selected: this.sortMode === \"category\" },\n    ];\n\n    return {\n      planes,\n      planeList,\n      hasCustomLayout: this.hasCustomLayout,\n      layoutStatusLabel: this.hasCustomLayout ? l(\"ui.layoutEditor.status.custom\") : l(\"ui.layoutEditor.status.default\"),\n      searchPlaceholder: l(\"ui.searchPlaceholder\"),\n      sortOptions,\n      isGm,\n    };\n  }\n\n  override async _onRender(context: DeepPartial<PlanarLayoutEditorContext>, options: DeepPartial<AppV2RenderOptions>): Promise<void> {\n    await super._onRender(context, options);\n\n    if (!game.user?.isGM) {\n      notify.warn(l(\"notifications.gmOnly\"));\n      await this.close();\n      return;\n    }\n\n    const element = this.element;\n    if (!element) return;\n\n    const mapContainer = element.querySelector<HTMLElement>(\".planar-map-container\");\n    if (mapContainer) {\n      this.bindMapInteractions(mapContainer);\n      this.applyZoom(mapContainer);\n    }\n\n    this.bindSidebarActions(element);\n    this.applySearchFilter();\n    this.applySelection();\n  }\n\n  private reloadLayoutFromSettings(): void {\n    this.layout = getEffectiveLayout();\n    this.hasCustomLayout = getCustomLayout() !== null;\n    this.needsReload = false;\n    this.syncSelectedPlane();\n  }\n\n  private syncSelectedPlane(): void {\n    if (this.selectedPlaneId && !this.layout.some(plane => plane.id === this.selectedPlaneId)) {\n      this.selectedPlaneId = undefined;\n    }\n  }\n\n  private getSortedPlaneList(): Plane[] {\n    const planes = [...this.layout];\n    if (this.sortMode === \"name\") {\n      return planes.sort((a, b) => a.name.localeCompare(b.name));\n    }\n    if (this.sortMode === \"category\") {\n      const order: Record<PlaneCategory, number> = { major: 0, minor: 1, special: 2 };\n      return planes.sort((a, b) => (order[a.category ?? \"minor\"] ?? 99) - (order[b.category ?? \"minor\"] ?? 99) || a.name.localeCompare(b.name));\n    }\n    return planes;\n  }\n\n  private bindMapInteractions(container: HTMLElement): void {\n    const nodes = container.querySelectorAll<HTMLElement>(\".planar-layout-node\");\n    nodes.forEach(node => {\n      node.addEventListener(\"pointerdown\", (e: PointerEvent) => this.onPlanePointerDown(e, node, container));\n    });\n\n    container.addEventListener(\n      \"wheel\",\n      (e: WheelEvent) => {\n        e.preventDefault();\n        this.onMapZoom(e, container);\n      },\n      { passive: false }\n    );\n\n    container.addEventListener(\"pointerdown\", (e: PointerEvent) => this.onMapPointerDown(e, container));\n    container.addEventListener(\"pointermove\", (e: PointerEvent) => this.onMapPointerMove(e, container));\n    container.addEventListener(\"pointerup\", (e: PointerEvent) => this.onMapPointerEnd(e, container));\n    container.addEventListener(\"pointercancel\", (e: PointerEvent) => this.onMapPointerEnd(e, container));\n\n    const resetBtn = this.element?.querySelector<HTMLButtonElement>(\".planar-map-reset-btn\");\n    if (resetBtn) {\n      resetBtn.addEventListener(\"click\", e => {\n        e.preventDefault();\n        this.resetView(container);\n      });\n    }\n  }\n\n  private bindSidebarActions(element: HTMLElement): void {\n    const searchInput = element.querySelector<HTMLInputElement>(\".planar-layout-search-input\");\n    if (searchInput) {\n      searchInput.value = this.searchFilter;\n      searchInput.addEventListener(\"input\", () => {\n        this.searchFilter = searchInput.value.toLowerCase().trim();\n        this.applySearchFilter();\n      });\n    }\n\n    const sortSelect = element.querySelector<HTMLSelectElement>(\".planar-layout-sort-select\");\n    if (sortSelect) {\n      sortSelect.value = this.sortMode;\n      sortSelect.addEventListener(\"change\", () => {\n        this.sortMode = (sortSelect.value as SortMode) || \"default\";\n        void this.render();\n      });\n    }\n\n    element.querySelector<HTMLButtonElement>(\".planar-layout-save-btn\")?.addEventListener(\"click\", () => void this.saveLayout());\n    element.querySelector<HTMLButtonElement>(\".planar-layout-cancel-btn\")?.addEventListener(\"click\", () => void this.reloadLayout());\n    element.querySelector<HTMLButtonElement>(\".planar-layout-create-btn\")?.addEventListener(\"click\", () => void this.openCreateDialog());\n    element.querySelector<HTMLButtonElement>(\".planar-layout-reset-btn\")?.addEventListener(\"click\", () => void this.resetLayout());\n    element.querySelector<HTMLButtonElement>(\".planar-layout-export-btn\")?.addEventListener(\"click\", () => void this.exportLayout());\n    element.querySelector<HTMLButtonElement>(\".planar-layout-import-btn\")?.addEventListener(\"click\", () => void this.importLayout());\n\n    const list = element.querySelector<HTMLElement>(\".planar-layout-plane-list\");\n    if (list) {\n      list.addEventListener(\"click\", e => {\n        const target = e.target as HTMLElement | null;\n        if (!target) return;\n\n        const actionBtn = target.closest<HTMLButtonElement>(\"[data-action]\");\n        if (actionBtn) {\n          e.preventDefault();\n          const planeId = actionBtn.dataset.planeId;\n          const action = actionBtn.dataset.action;\n          if (!planeId || !action) return;\n          if (action === \"edit\") void this.openEditDialog(planeId);\n          if (action === \"toggle-hidden\") this.togglePlaneHidden(planeId);\n          if (action === \"delete\") void this.deletePlane(planeId);\n          return;\n        }\n\n        const item = target.closest<HTMLElement>(\".plane-list-item\");\n        if (item?.dataset?.planeId) {\n          this.setSelectedPlaneId(item.dataset.planeId);\n        }\n      });\n    }\n  }\n\n  private onPlanePointerDown(event: PointerEvent, node: HTMLElement, container: HTMLElement): void {\n    if (event.button !== 0) return;\n    event.preventDefault();\n    event.stopPropagation();\n\n    const planeId = node.dataset.planeId;\n    if (!planeId) return;\n\n    this.isDraggingPlane = true;\n    this.dragPlaneId = planeId;\n    this.dragPlaneNode = node;\n    this.dragMoved = false;\n    this.dragStartClientX = event.clientX;\n    this.dragStartClientY = event.clientY;\n\n    this.setSelectedPlaneId(planeId);\n\n    node.classList.add(\"dragging\");\n    container.setPointerCapture(event.pointerId);\n  }\n\n  private onMapPointerDown(event: PointerEvent, container: HTMLElement): void {\n    if (event.button !== 0) return;\n    if ((event.target as HTMLElement | null)?.closest?.(\".planar-layout-node\")) return;\n\n    event.preventDefault();\n\n    this.isPanning = true;\n    this.panMoved = false;\n    this.panStartClientX = event.clientX;\n    this.panStartClientY = event.clientY;\n    this.panStartX = this.panX;\n    this.panStartY = this.panY;\n\n    container.classList.add(\"panning\");\n    container.setPointerCapture(event.pointerId);\n  }\n\n  private onMapPointerMove(event: PointerEvent, container: HTMLElement): void {\n    if (this.isDraggingPlane) {\n      event.preventDefault();\n      if (!this.dragPlaneId || !this.dragPlaneNode) return;\n\n      const dx = event.clientX - this.dragStartClientX;\n      const dy = event.clientY - this.dragStartClientY;\n      if (!this.dragMoved && Math.hypot(dx, dy) > 2) this.dragMoved = true;\n\n      const { x, y } = this.getNormalizedPointerPosition(event, container);\n      this.updatePlanePosition(this.dragPlaneId, x, y, this.dragPlaneNode);\n      return;\n    }\n\n    if (!this.isPanning) return;\n\n    event.preventDefault();\n\n    const dx = event.clientX - this.panStartClientX;\n    const dy = event.clientY - this.panStartClientY;\n    if (!this.panMoved && Math.hypot(dx, dy) > 4) this.panMoved = true;\n\n    this.panX = this.panStartX + dx;\n    this.panY = this.panStartY + dy;\n    this.applyZoom(container);\n  }\n\n  private onMapPointerEnd(event: PointerEvent, container: HTMLElement): void {\n    if (this.isDraggingPlane) {\n      this.isDraggingPlane = false;\n      this.dragPlaneId = undefined;\n      this.dragPlaneNode?.classList.remove(\"dragging\");\n      this.dragPlaneNode = undefined;\n      try {\n        container.releasePointerCapture(event.pointerId);\n      } catch {\n        // ignore\n      }\n      return;\n    }\n\n    if (!this.isPanning) return;\n    this.isPanning = false;\n    container.classList.remove(\"panning\");\n    try {\n      container.releasePointerCapture(event.pointerId);\n    } catch {\n      // ignore\n    }\n  }\n\n  private onMapZoom(event: WheelEvent, container: HTMLElement): void {\n    const rect = container.getBoundingClientRect();\n    const mouseX = event.clientX - rect.left;\n    const mouseY = event.clientY - rect.top;\n\n    const oldZoom = this.zoomLevel;\n    const factor = event.deltaY > 0 ? 0.9 : 1.1;\n    const nextZoom = oldZoom * factor;\n    const newZoom = Math.max(this.MIN_ZOOM, Math.min(this.MAX_ZOOM, nextZoom));\n    if (newZoom === oldZoom) return;\n\n    const contentX = (mouseX - this.panX) / oldZoom;\n    const contentY = (mouseY - this.panY) / oldZoom;\n\n    this.zoomLevel = newZoom;\n    this.panX = mouseX - contentX * newZoom;\n    this.panY = mouseY - contentY * newZoom;\n    this.applyZoom(container);\n  }\n\n  private applyZoom(container: HTMLElement): void {\n    const content = container.querySelector<HTMLElement>(\".planar-map-content\");\n    if (!content) return;\n    content.style.transform = `translate(${this.panX}px, ${this.panY}px) scale(${this.zoomLevel})`;\n    content.style.transformOrigin = \"0 0\";\n  }\n\n  private resetView(container: HTMLElement): void {\n    this.zoomLevel = 1;\n    this.panX = 0;\n    this.panY = 0;\n    this.applyZoom(container);\n  }\n\n  private getNormalizedPointerPosition(event: PointerEvent, container: HTMLElement): { x: number; y: number } {\n    const rect = container.getBoundingClientRect();\n    const mouseX = event.clientX - rect.left;\n    const mouseY = event.clientY - rect.top;\n\n    const contentX = (mouseX - this.panX) / this.zoomLevel;\n    const contentY = (mouseY - this.panY) / this.zoomLevel;\n\n    return {\n      x: this.clamp(contentX / rect.width, 0, 1),\n      y: this.clamp(contentY / rect.height, 0, 1),\n    };\n  }\n\n  private updatePlanePosition(planeId: string, x: number, y: number, node?: HTMLElement): void {\n    const plane = this.layout.find(p => p.id === planeId);\n    if (!plane) return;\n\n    plane.x = x;\n    plane.y = y;\n\n    const targetNode = node ?? this.element?.querySelector<HTMLElement>(`.planar-layout-node[data-plane-id=\"${planeId}\"]`);\n    if (targetNode) {\n      targetNode.style.left = `${x * 100}%`;\n      targetNode.style.top = `${y * 100}%`;\n    }\n  }\n\n  private applySearchFilter(): void {\n    const element = this.element;\n    if (!element) return;\n\n    const searchLower = this.searchFilter.toLowerCase();\n    const nodes = element.querySelectorAll<HTMLElement>(\".planar-layout-node\");\n    const listItems = element.querySelectorAll<HTMLElement>(\".plane-list-item\");\n\n    nodes.forEach(node => {\n      const planeName = node.dataset.planeName?.toLowerCase() ?? \"\";\n      const matches = searchLower === \"\" || planeName.includes(searchLower);\n      node.classList.toggle(\"search-hidden\", !matches);\n      node.classList.toggle(\"search-match\", matches && searchLower !== \"\");\n    });\n\n    listItems.forEach(item => {\n      const planeName = item.dataset.planeName?.toLowerCase() ?? \"\";\n      const matches = searchLower === \"\" || planeName.includes(searchLower);\n      item.classList.toggle(\"search-hidden\", !matches);\n    });\n  }\n\n  private applySelection(): void {\n    if (!this.selectedPlaneId) return;\n    this.setSelectedPlaneId(this.selectedPlaneId);\n  }\n\n  private setSelectedPlaneId(planeId?: string): void {\n    this.selectedPlaneId = planeId;\n    const element = this.element;\n    if (!element) return;\n\n    element.querySelectorAll<HTMLElement>(\".planar-layout-node\").forEach(node => {\n      node.classList.toggle(\"is-selected\", node.dataset.planeId === planeId);\n    });\n    element.querySelectorAll<HTMLElement>(\".plane-list-item\").forEach(item => {\n      item.classList.toggle(\"is-selected\", item.dataset.planeId === planeId);\n    });\n  }\n\n  private clamp(value: number, min: number, max: number): number {\n    return Math.max(min, Math.min(max, value));\n  }\n\n  private normalizeCoordinate(value: number, fallback: number): number {\n    if (!Number.isFinite(value)) return fallback;\n    return this.clamp(value, 0, 1);\n  }\n\n  private async openCreateDialog(): Promise<void> {\n    const content = this.buildPlaneFormContent({\n      mode: \"create\",\n      name: \"\",\n      id: \"\",\n      category: \"minor\",\n      x: 0.5,\n      y: 0.5,\n      hidden: false,\n    });\n\n    const result = (await DialogV2.prompt({\n      window: { title: l(\"ui.layoutEditor.dialog.createTitle\"), resizable: false },\n      content,\n      ok: {\n        label: l(\"ui.layoutEditor.buttons.create\"),\n        icon: '<i class=\"fa-solid fa-plus\"></i>',\n        callback: (_evt: PointerEvent | SubmitEvent, btn: HTMLButtonElement) => this.getPlaneFormValues(btn.form),\n      },\n      cancel: {\n        label: l(\"ui.layoutEditor.buttons.cancel\"),\n        callback: () => null,\n      },\n      rejectClose: false,\n    })) as PlaneFormValues | null;\n\n    if (!result) return;\n\n    const name = result.name.trim();\n    if (!name) return notify.error(l(\"notifications.layoutMissingName\"));\n\n    const generatedId = normalizePlaneId(name);\n    const id = (result.id.trim() || generatedId).trim();\n    if (!id) return notify.error(l(\"notifications.layoutMissingId\"));\n    if (this.layout.some(plane => plane.id === id)) {\n      return notify.error(lf(\"notifications.layoutDuplicateId\", { id }));\n    }\n\n    const plane: Plane = {\n      id,\n      name,\n      category: this.normalizeCategory(result.category),\n      x: this.normalizeCoordinate(result.x, 0.5),\n      y: this.normalizeCoordinate(result.y, 0.5),\n      hidden: result.hidden,\n    };\n\n    this.layout.push(plane);\n    this.selectedPlaneId = plane.id;\n    await this.render();\n  }\n\n  private async openEditDialog(planeId: string): Promise<void> {\n    const plane = this.layout.find(p => p.id === planeId);\n    if (!plane) return;\n\n    const content = this.buildPlaneFormContent({\n      mode: \"edit\",\n      name: plane.name,\n      id: plane.id,\n      category: plane.category ?? \"minor\",\n      x: plane.x,\n      y: plane.y,\n      hidden: plane.hidden === true,\n    });\n\n    const result = (await DialogV2.prompt({\n      window: { title: l(\"ui.layoutEditor.dialog.editTitle\"), resizable: false },\n      content,\n      ok: {\n        label: l(\"ui.layoutEditor.buttons.save\"),\n        icon: '<i class=\"fa-solid fa-check\"></i>',\n        callback: (_evt: PointerEvent | SubmitEvent, btn: HTMLButtonElement) => this.getPlaneFormValues(btn.form),\n      },\n      cancel: {\n        label: l(\"ui.layoutEditor.buttons.cancel\"),\n        callback: () => null,\n      },\n      rejectClose: false,\n    })) as PlaneFormValues | null;\n\n    if (!result) return;\n\n    const name = result.name.trim();\n    if (!name) return notify.error(l(\"notifications.layoutMissingName\"));\n\n    plane.name = name;\n    plane.category = this.normalizeCategory(result.category);\n    plane.hidden = result.hidden;\n    plane.x = this.normalizeCoordinate(result.x, plane.x);\n    plane.y = this.normalizeCoordinate(result.y, plane.y);\n\n    await this.render();\n  }\n\n  private getPlaneFormValues(form?: HTMLFormElement | null): PlaneFormValues | null {\n    if (!form) return null;\n    const elements = form.elements as any;\n    const name = String(elements.name?.value ?? \"\");\n    const id = String(elements.id?.value ?? \"\");\n    const category = String(elements.category?.value ?? \"minor\") as PlaneCategory;\n    const x = Number(elements.x?.value ?? 0);\n    const y = Number(elements.y?.value ?? 0);\n    const hidden = Boolean(elements.hidden?.checked);\n    return { name, id, category, x, y, hidden };\n  }\n\n  private normalizeCategory(category: PlaneCategory | string): PlaneCategory {\n    if (category === \"major\" || category === \"minor\" || category === \"special\") return category;\n    return \"minor\";\n  }\n\n  private buildPlaneFormContent(data: {\n    mode: \"create\" | \"edit\";\n    name: string;\n    id: string;\n    category: PlaneCategory;\n    x: number;\n    y: number;\n    hidden: boolean;\n  }): string {\n    const esc = foundry.utils.escapeHTML;\n    const name = esc(data.name ?? \"\");\n    const id = esc(data.id ?? \"\");\n    const x = Number.isFinite(data.x) ? data.x.toFixed(2) : \"0.50\";\n    const y = Number.isFinite(data.y) ? data.y.toFixed(2) : \"0.50\";\n    const isEdit = data.mode === \"edit\";\n    const idNote = isEdit ? l(\"ui.layoutEditor.dialog.idLocked\") : l(\"ui.layoutEditor.dialog.idHint\");\n\n    return `\n      <div class=\"planar-layout-dialog\">\n        <div class=\"form-group form-grid\">\n          <label for=\"plane-name\">${l(\"ui.layoutEditor.fields.name\")}</label>\n          <div class=\"form-fields\">\n            <input id=\"plane-name\" name=\"name\" type=\"text\" value=\"${name}\" required />\n          </div>\n        </div>\n        <div class=\"form-group form-grid\">\n          <label for=\"plane-id\">${l(\"ui.layoutEditor.fields.id\")}</label>\n          <div class=\"form-fields\">\n            <input id=\"plane-id\" name=\"id\" type=\"text\" value=\"${id}\" ${isEdit ? \"readonly\" : \"\"} />\n          </div>\n          <p class=\"notes\">${idNote}</p>\n        </div>\n        <div class=\"form-group form-grid\">\n          <label for=\"plane-category\">${l(\"ui.layoutEditor.fields.category\")}</label>\n          <div class=\"form-fields\">\n            <select id=\"plane-category\" name=\"category\">\n              <option value=\"major\" ${data.category === \"major\" ? \"selected\" : \"\"}>${l(\"ui.legend.major\")}</option>\n              <option value=\"minor\" ${data.category === \"minor\" ? \"selected\" : \"\"}>${l(\"ui.legend.minor\")}</option>\n              <option value=\"special\" ${data.category === \"special\" ? \"selected\" : \"\"}>${l(\"ui.legend.special\")}</option>\n            </select>\n          </div>\n        </div>\n        <div class=\"form-group form-grid\">\n          <label for=\"plane-x\">${l(\"ui.layoutEditor.fields.x\")}</label>\n          <div class=\"form-fields\">\n            <input id=\"plane-x\" name=\"x\" type=\"number\" step=\"0.01\" min=\"0\" max=\"1\" value=\"${x}\" />\n          </div>\n        </div>\n        <div class=\"form-group form-grid\">\n          <label for=\"plane-y\">${l(\"ui.layoutEditor.fields.y\")}</label>\n          <div class=\"form-fields\">\n            <input id=\"plane-y\" name=\"y\" type=\"number\" step=\"0.01\" min=\"0\" max=\"1\" value=\"${y}\" />\n          </div>\n        </div>\n        <div class=\"form-group form-grid is-checkbox\">\n          <label for=\"plane-hidden\">${l(\"ui.layoutEditor.fields.hidden\")}</label>\n          <div class=\"form-fields\">\n            <input id=\"plane-hidden\" name=\"hidden\" type=\"checkbox\" ${data.hidden ? \"checked\" : \"\"} />\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private async deletePlane(planeId: string): Promise<void> {\n    const plane = this.layout.find(p => p.id === planeId);\n    if (!plane) return;\n\n    const confirmed = await DialogV2.confirm({\n      window: { title: l(\"ui.layoutEditor.dialog.deleteTitle\") },\n      content: `<p>${lf(\"ui.layoutEditor.dialog.deleteConfirm\", { name: foundry.utils.escapeHTML(plane.name) })}</p>`,\n      rejectClose: false,\n    });\n\n    if (!confirmed) return;\n\n    this.layout = this.layout.filter(p => p.id !== planeId);\n    if (this.selectedPlaneId === planeId) this.selectedPlaneId = undefined;\n    await this.render();\n  }\n\n  private togglePlaneHidden(planeId: string): void {\n    const plane = this.layout.find(p => p.id === planeId);\n    if (!plane) return;\n    plane.hidden = !plane.hidden;\n    void this.render();\n  }\n\n  private async saveLayout(): Promise<void> {\n    const validation = validateLayout(this.layout);\n    if (!validation.valid) {\n      notify.error(lf(\"notifications.layoutInvalid\", { errors: validation.errors.join(\"; \") }));\n      return;\n    }\n\n    try {\n      await saveCustomLayout(this.layout);\n      this.needsReload = true;\n      this.reloadLayoutFromSettings();\n      notify.success(l(\"notifications.layoutSaved\"));\n      this.emitLayoutRefresh(\"layout-updated\");\n      await this.render();\n    } catch (err: any) {\n      notify.error(lf(\"notifications.layoutSaveFailed\", { error: err?.message ?? String(err) }));\n    }\n  }\n\n  private async reloadLayout(): Promise<void> {\n    this.needsReload = true;\n    await this.render();\n  }\n\n  private async resetLayout(): Promise<void> {\n    const confirmed = await DialogV2.confirm({\n      window: { title: l(\"ui.layoutEditor.dialog.resetTitle\") },\n      content: `<p>${l(\"ui.layoutEditor.dialog.resetConfirm\")}</p>`,\n      rejectClose: false,\n    });\n    if (!confirmed) return;\n\n    await resetLayoutToDefault();\n    this.layout = getDefaultLayout();\n    this.hasCustomLayout = false;\n    this.syncSelectedPlane();\n    notify.success(l(\"notifications.layoutReset\"));\n    this.emitLayoutRefresh(\"layout-reset\");\n    await this.render();\n  }\n\n  private async exportLayout(): Promise<void> {\n    const payload = JSON.stringify({ planes: this.layout }, null, 2);\n    try {\n      if (navigator.clipboard?.writeText) {\n        await navigator.clipboard.writeText(payload);\n        notify.success(l(\"notifications.layoutCopied\"));\n        return;\n      }\n    } catch {\n      // fallback to dialog below\n    }\n\n    const escaped = foundry.utils.escapeHTML(payload);\n    await DialogV2.prompt({\n      window: { title: l(\"ui.layoutEditor.dialog.exportTitle\"), resizable: true },\n      content: `\n        <div class=\"planar-layout-dialog\">\n          <div class=\"form-group\">\n            <textarea name=\"export\" rows=\"18\" style=\"width:100%;resize:vertical;\">${escaped}</textarea>\n          </div>\n        </div>\n      `,\n      ok: {\n        label: l(\"ui.layoutEditor.buttons.close\"),\n        icon: '<i class=\"fa-solid fa-check\"></i>',\n        callback: () => true,\n      },\n      cancel: {\n        label: l(\"ui.layoutEditor.buttons.cancel\"),\n        callback: () => false,\n      },\n      rejectClose: false,\n    });\n  }\n\n  private async importLayout(): Promise<void> {\n    const result = (await DialogV2.prompt({\n      window: { title: l(\"ui.layoutEditor.dialog.importTitle\"), resizable: true },\n      content: `\n        <div class=\"planar-layout-dialog\">\n          <div class=\"form-group\">\n            <label for=\"layout-json\">${l(\"ui.layoutEditor.dialog.importHint\")}</label>\n            <textarea id=\"layout-json\" name=\"layout-json\" rows=\"12\" style=\"width:100%;resize:vertical;\"></textarea>\n          </div>\n        </div>\n      `,\n      ok: {\n        label: l(\"ui.layoutEditor.buttons.import\"),\n        icon: '<i class=\"fa-solid fa-file-import\"></i>',\n        callback: (_evt: PointerEvent | SubmitEvent, btn: HTMLButtonElement) => {\n          const value = String((btn.form?.elements as any)?.[\"layout-json\"]?.value ?? \"\");\n          return value.trim();\n        },\n      },\n      cancel: {\n        label: l(\"ui.layoutEditor.buttons.cancel\"),\n        callback: () => \"\",\n      },\n      rejectClose: false,\n    })) as string | null;\n\n    if (!result) return;\n\n    let parsed: unknown;\n    try {\n      parsed = JSON.parse(result);\n    } catch (err: any) {\n      notify.error(lf(\"notifications.layoutImportFailed\", { error: err?.message ?? \"Invalid JSON\" }));\n      return;\n    }\n\n    const planes = Array.isArray(parsed) ? parsed : (parsed as any)?.planes;\n    if (!Array.isArray(planes)) {\n      notify.error(l(\"notifications.layoutImportInvalid\"));\n      return;\n    }\n\n    const validation = validateLayout(planes as Plane[]);\n    if (!validation.valid) {\n      notify.error(lf(\"notifications.layoutInvalid\", { errors: validation.errors.join(\"; \") }));\n      return;\n    }\n\n    try {\n      await saveCustomLayout(planes as Plane[]);\n      this.needsReload = true;\n      this.reloadLayoutFromSettings();\n      notify.success(l(\"notifications.layoutImported\"));\n      this.emitLayoutRefresh(\"layout-imported\");\n      await this.render();\n    } catch (err: any) {\n      notify.error(lf(\"notifications.layoutSaveFailed\", { error: err?.message ?? String(err) }));\n    }\n  }\n\n  private emitLayoutRefresh(reason: string): void {\n    emitRefresh({ view: \"planar-index\", reason }, { includeSelf: true });\n  }\n}\n", "import { HandlebarsApplication, getModuleApi } from \"@helpers\";\n\nimport type { DeepPartial } from \"fvtt-types/utils\";\nimport type { DefaultOptions, HandlebarsTemplatePart, FormBaseInterface, AppV2RenderOptions, Context } from \"../types/base-form.types\";\nimport type { RefreshEvent } from \"app/core/net/refresh-bus\";\n\nexport abstract class BaseForm extends HandlebarsApplication implements FormBaseInterface {\n  #offRefresh?: () => void;\n  #refreshBound = false;\n\n  viewId(): string {\n    return this.constructor.name;\n  }\n  refreshKey(): string | undefined {\n    return undefined;\n  }\n\n  static get DEFAULT_OPTIONS(): DefaultOptions {\n    return {\n      classes: [],\n      tag: \"div\",\n      window: {\n        frame: true,\n        positioned: true,\n        title: \"\",\n        icon: \"\",\n        controls: [],\n        minimizable: true,\n        resizable: false,\n        contentTag: \"section\",\n        contentClasses: [],\n      },\n      actions: {},\n      form: {\n        handler: undefined,\n        submitOnChange: false,\n        closeOnSubmit: false,\n      },\n      position: {\n        width: \"auto\",\n        height: \"auto\",\n      },\n    };\n  }\n\n  static get PARTS(): Record<string, HandlebarsTemplatePart> {\n    return {\n      content: {\n        template: \"\",\n        classes: [],\n        scrollable: [],\n      },\n    };\n  }\n\n  async _prepareContext(options: DeepPartial<AppV2RenderOptions> & { isFirstRender: boolean }): Promise<Context> {\n    return {}; // no-op; subclasses can override\n  }\n\n  async _onRender(context: DeepPartial<Context>, options: DeepPartial<AppV2RenderOptions>): Promise<void> {\n    const moduleApi = getModuleApi() as ModuleAPI;\n    const ws = moduleApi.werewolfSocket;\n\n    if (!this.#refreshBound) {\n      this.#refreshBound = true;\n      this.#offRefresh = ws.on(\"lw:refresh\", async env => {\n        const ev = env.payload as RefreshEvent | undefined;\n        if (!ev) return;\n        if (ev.view !== this.viewId()) return;\n\n        const myKey = this.refreshKey();\n        if (ev.key && myKey && ev.key !== myKey) return;\n\n        try {\n          await this.handleRefresh(ev);\n        } catch (err) {\n          console.error(`[BaseForm] handleRefresh error in ${this.viewId()}:`, err);\n        }\n      });\n    }\n  }\n\n  protected async handleRefresh(ev: RefreshEvent) {\n    await this.render(true);\n  }\n\n  async close(options?: { animate?: boolean; closeKey?: boolean; submitted?: boolean }): Promise<this> {\n    try {\n      if (this.#offRefresh) this.#offRefresh();\n      return await super.close(options);\n    } finally {\n      this.#offRefresh = undefined;\n      this.#refreshBound = false;\n    }\n  }\n}\n", "import { getModuleApi } from \"@helpers\";\n\nexport type RefreshEvent = {\n  view: string;\n  key?: string;\n  reason?: string;\n};\n\nexport function emitRefresh(ev: RefreshEvent, opts?: { targetUserId?: string; includeSelf?: boolean }) {\n  const moduleApi = getModuleApi() as ModuleAPI;\n  const ws = moduleApi.werewolfSocket;\n\n  ws.emit(\"lw:refresh\", ev, {\n    targetUserId: opts?.targetUserId ?? \"\",\n    loopback: opts?.includeSelf === true,\n  });\n}\n", "import { MODULE_ID, duplicate, requireGmOrThrow } from \"@helpers\";\nimport { PLANAR_LAYOUT, slugify } from \"app/core/data/planar-layout\";\n\nimport type { Plane, PlanarLayout, PlaneCategory } from \"app/core/types/plane.types\";\nimport { SETTINGS_KEYS } from \"./register.service\";\n\ntype LayoutLike = PlanarLayout | Plane[] | null | undefined;\n\nconst VALID_CATEGORIES: PlaneCategory[] = [\"major\", \"minor\", \"special\"];\n\nfunction extractPlanes(layout: LayoutLike): Plane[] | null {\n  if (!layout) return null;\n  const planes = Array.isArray(layout) ? layout : layout.planes;\n  return Array.isArray(planes) ? planes : null;\n}\n\nfunction normalizePlane(plane: Plane): Plane {\n  return {\n    ...plane,\n    category: plane.category ?? \"minor\",\n    hidden: plane.hidden === true,\n  };\n}\n\nfunction normalizePlanes(planes: Plane[]): Plane[] {\n  return planes.map(normalizePlane);\n}\n\nexport function normalizePlaneId(name: string): string {\n  return slugify(name);\n}\n\nexport function getDefaultLayout(): Plane[] {\n  return normalizePlanes(duplicate(PLANAR_LAYOUT) as Plane[]);\n}\n\nexport function getCustomLayout(): Plane[] | null {\n  const g = game as Game;\n  const raw = g.settings.get(MODULE_ID, SETTINGS_KEYS.CustomPlanarLayout) as LayoutLike;\n  const planes = extractPlanes(raw);\n  if (!planes) return null;\n\n  const normalized = normalizePlanes(duplicate(planes) as Plane[]);\n  const validation = validateLayout(normalized);\n  if (!validation.valid) {\n    console.warn(\"[planar-layout] Custom layout invalid, falling back to default:\", validation.errors);\n    return null;\n  }\n\n  return normalized;\n}\n\nexport function getEffectiveLayout(): Plane[] {\n  return getCustomLayout() ?? getDefaultLayout();\n}\n\nexport async function saveCustomLayout(layout: Plane[] | PlanarLayout): Promise<void> {\n  requireGmOrThrow();\n  const g = game as Game;\n  const planes = extractPlanes(layout);\n  if (!planes) throw new Error(\"Layout missing planes array.\");\n\n  const normalized = normalizePlanes(duplicate(planes) as Plane[]);\n  const validation = validateLayout(normalized);\n  if (!validation.valid) throw new Error(validation.errors.join(\"; \"));\n\n  await g.settings.set(MODULE_ID, SETTINGS_KEYS.CustomPlanarLayout, { planes: normalized });\n}\n\nexport async function resetLayoutToDefault(): Promise<void> {\n  requireGmOrThrow();\n  const g = game as Game;\n  await g.settings.set(MODULE_ID, SETTINGS_KEYS.CustomPlanarLayout, null);\n}\n\nexport function validateLayout(layout: Plane[] | PlanarLayout): { valid: boolean; errors: string[] } {\n  const planes = extractPlanes(layout);\n  if (!planes) return { valid: false, errors: [\"Layout missing planes array.\"] };\n\n  const errors: string[] = [];\n  const seen = new Set<string>();\n\n  for (const plane of planes) {\n    const id = (plane.id ?? \"\").trim();\n    const name = (plane.name ?? \"\").trim();\n\n    if (!id) errors.push(\"Plane id is empty.\");\n    if (!name) errors.push(`Plane ${id || \"(unknown)\"} has empty name.`);\n\n    if (id) {\n      if (seen.has(id)) errors.push(`Duplicate plane id: ${id}`);\n      seen.add(id);\n    }\n\n    if (!Number.isFinite(plane.x)) errors.push(`Plane ${id || \"(unknown)\"} has invalid x: ${plane.x}`);\n    if (!Number.isFinite(plane.y)) errors.push(`Plane ${id || \"(unknown)\"} has invalid y: ${plane.y}`);\n\n    if (Number.isFinite(plane.x) && (plane.x < 0 || plane.x > 1)) {\n      errors.push(`Plane ${id || \"(unknown)\"} x out of bounds: ${plane.x}`);\n    }\n    if (Number.isFinite(plane.y) && (plane.y < 0 || plane.y > 1)) {\n      errors.push(`Plane ${id || \"(unknown)\"} y out of bounds: ${plane.y}`);\n    }\n\n    if (plane.category && !VALID_CATEGORIES.includes(plane.category)) {\n      errors.push(`Plane ${id || \"(unknown)\"} has invalid category: ${plane.category}`);\n    }\n  }\n\n  return { valid: errors.length === 0, errors };\n}\n", "import type { Plane, PlaneCategory } from \"../types/plane.types\";\n\n/**\n * Generates a slug from a plane name\n */\nexport function slugify(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/\\s+/g, \"-\")\n    .replace(/[^a-z0-9-]/g, \"\");\n}\n\n/**\n * Creates a plane entry with auto-generated slug ID\n */\nfunction plane(name: string, x: number, y: number, category: PlaneCategory = \"major\"): Plane {\n  return {\n    id: slugify(name),\n    name,\n    x,\n    y,\n    category,\n  };\n}\n\n/**\n * The complete planar layout for the Magic multiverse.\n * Coordinates are normalized 0-1, arranged to resemble a cosmic map.\n *\n * Layout design:\n * - Center: Dominaria (the hub of the multiverse)\n * - Inner ring: Major story planes\n * - Outer regions: Minor and obscure planes\n * - Top: Blind Eternities (special cosmic node)\n */\nexport const PLANAR_LAYOUT: Plane[] = [\n  // === CENTRAL HUB ===\n  plane(\"Dominaria\", 0.5, 0.48, \"major\"),\n\n  // === INNER RING - Major Story Planes ===\n  plane(\"Ravnica\", 0.65, 0.35, \"major\"),\n  plane(\"Zendikar\", 0.72, 0.52, \"major\"),\n  plane(\"Innistrad\", 0.62, 0.65, \"major\"),\n  plane(\"Mirrodin\", 0.38, 0.65, \"major\"),\n  plane(\"New Phyrexia\", 0.28, 0.52, \"major\"),\n  plane(\"Phyrexia\", 0.35, 0.35, \"major\"),\n  plane(\"Theros\", 0.5, 0.28, \"major\"),\n\n  // === SECOND RING - Popular Planes ===\n  plane(\"Ixalan\", 0.82, 0.38, \"major\"),\n  plane(\"Amonkhet\", 0.85, 0.55, \"major\"),\n  plane(\"Kaladesh\", 0.78, 0.68, \"major\"),\n  plane(\"Tarkir\", 0.65, 0.78, \"major\"),\n  plane(\"Alara\", 0.45, 0.78, \"major\"),\n  plane(\"Lorwyn\", 0.32, 0.75, \"major\"),\n  plane(\"Shadowmoor\", 0.22, 0.65, \"major\"),\n  plane(\"Kamigawa\", 0.18, 0.48, \"major\"),\n  plane(\"Kaldheim\", 0.22, 0.32, \"major\"),\n  plane(\"Eldraine\", 0.35, 0.22, \"major\"),\n  plane(\"Ikoria\", 0.55, 0.18, \"major\"),\n  plane(\"Arcavios\", 0.7, 0.22, \"major\"),\n  plane(\"Strixhaven\", 0.78, 0.28, \"major\"),\n  plane(\"New Capenna\", 0.88, 0.45, \"major\"),\n\n  // === OUTER RING - Lesser Known Planes ===\n  plane(\"Fiora\", 0.92, 0.32, \"minor\"),\n  plane(\"Kylem\", 0.95, 0.48, \"minor\"),\n  plane(\"Shandalar\", 0.92, 0.62, \"minor\"),\n  plane(\"Ulgrotha\", 0.88, 0.75, \"minor\"),\n  plane(\"Vryn\", 0.78, 0.82, \"minor\"),\n  plane(\"Mercadia\", 0.62, 0.88, \"minor\"),\n  plane(\"Rabiah\", 0.48, 0.9, \"minor\"),\n  plane(\"Segovia\", 0.35, 0.88, \"minor\"),\n  plane(\"Belenon\", 0.22, 0.82, \"minor\"),\n  plane(\"Iquatana\", 0.12, 0.72, \"minor\"),\n  plane(\"Regatha\", 0.08, 0.55, \"minor\"),\n  plane(\"Muraganda\", 0.08, 0.4, \"minor\"),\n  plane(\"Pyrulea\", 0.12, 0.25, \"minor\"),\n  plane(\"Xerex\", 0.25, 0.15, \"minor\"),\n  plane(\"Gobakhan\", 0.42, 0.1, \"minor\"),\n  plane(\"Ergamon\", 0.58, 0.08, \"minor\"),\n  plane(\"Kephalai\", 0.72, 0.1, \"minor\"),\n  plane(\"Kinshala\", 0.85, 0.18, \"minor\"),\n\n  // === EDGE PLANES - Obscure ===\n  plane(\"Ir\", 0.05, 0.28, \"minor\"),\n  plane(\"Kolbahan\", 0.05, 0.68, \"minor\"),\n  plane(\"Equilor\", 0.15, 0.9, \"minor\"),\n  plane(\"Azgol\", 0.28, 0.95, \"minor\"),\n  plane(\"Moag\", 0.5, 0.95, \"minor\"),\n  plane(\"Tavelia\", 0.72, 0.92, \"minor\"),\n  plane(\"Meditation Realm\", 0.88, 0.88, \"minor\"),\n\n  // === SPECIAL - Cosmic Nodes ===\n  plane(\"Blind Eternities\", 0.5, 0.02, \"special\"),\n];\n\n/**\n * Map of plane IDs to Plane objects for quick lookup\n */\nexport const PLANES_BY_ID: Record<string, Plane> = PLANAR_LAYOUT.reduce(\n  (acc, plane) => {\n    acc[plane.id] = plane;\n    return acc;\n  },\n  {} as Record<string, Plane>\n);\n\n/**\n * List of all plane IDs\n */\nexport const ALL_PLANE_IDS: string[] = PLANAR_LAYOUT.map(p => p.id);\n\n/**\n * Validates that all planes have valid coordinates and unique IDs\n */\nexport function validatePlanarLayout(): { valid: boolean; errors: string[] } {\n  const errors: string[] = [];\n  const seenIds = new Set<string>();\n\n  for (const plane of PLANAR_LAYOUT) {\n    // Check for duplicate IDs\n    if (seenIds.has(plane.id)) {\n      errors.push(`Duplicate plane ID: ${plane.id}`);\n    }\n    seenIds.add(plane.id);\n\n    // Check coordinate bounds\n    if (plane.x < 0 || plane.x > 1) {\n      errors.push(`Plane ${plane.id} has invalid x coordinate: ${plane.x}`);\n    }\n    if (plane.y < 0 || plane.y > 1) {\n      errors.push(`Plane ${plane.id} has invalid y coordinate: ${plane.y}`);\n    }\n\n    // Check for empty name\n    if (!plane.name || plane.name.trim() === \"\") {\n      errors.push(`Plane ${plane.id} has empty name`);\n    }\n  }\n\n  // Check total count matches expected (48 planes from the Magic multiverse)\n  const expectedCount = 48;\n  if (PLANAR_LAYOUT.length !== expectedCount) {\n    errors.push(`Expected ${expectedCount} planes, found ${PLANAR_LAYOUT.length}`);\n  }\n\n  return {\n    valid: errors.length === 0,\n    errors,\n  };\n}\n", "import { i18nLocalize as l } from \"@helpers\";\nimport { openPlanarIndex } from \"app/features/planar-index/PlanarIndex\";\nimport { countEnabledPlanes } from \"./plane-flags.service\";\nimport { getEffectiveLayout } from \"./planar-layout.service\";\n\n/**\n * Register Actor sheet header button hooks\n */\nexport function registerSheetButtonHooks(): void {\n  // Legacy ActorSheet (ApplicationV1)\n  Hooks.on(\"getActorSheetHeaderButtons\", (sheet: any, buttons: any[]) => {\n    const actor = sheet.actor || sheet.object;\n    if (!actor) return;\n\n    buttons.unshift({\n      label: l(\"ui.headerButton\"),\n      class: \"planar-index-btn\",\n      icon: \"fas fa-globe\",\n      onclick: () => openPlanarIndex(actor),\n    });\n  });\n\n  // ActorSheetV2 (ApplicationV2)\n  (Hooks as any).on(\"getHeaderControlsActorSheetV2\", (app: any, controls: any[]) => {\n    const actor = app.actor || app.document;\n    if (!actor) return;\n\n    controls.unshift({\n      label: l(\"ui.headerButton\"),\n      class: \"planar-index-btn\",\n      icon: \"fas fa-globe\",\n      onClick: () => openPlanarIndex(actor),\n    });\n  });\n}\n\n/**\n * Update the header button badge to show enabled plane count\n * This can be called after plane toggles to update the visual indicator\n */\nexport function updateHeaderButtonBadge(actorId: string): void {\n  const actor = game.actors?.get(actorId);\n  if (!actor) return;\n\n  const visiblePlaneIds = getEffectiveLayout()\n    .filter(plane => !plane.hidden)\n    .map(plane => plane.id);\n  const count = countEnabledPlanes(actor, visiblePlaneIds);\n\n  // Find all open sheets for this actor and update badges\n  for (const app of Object.values(ui.windows)) {\n    const sheet = app as any;\n    if (sheet?.actor?.id === actorId || sheet?.document?.id === actorId) {\n      const btn = sheet.element?.querySelector?.(\".planar-index-btn\");\n      if (btn) {\n        // Update or create badge\n        let badge = btn.querySelector(\".plane-count-badge\");\n        if (!badge && count > 0) {\n          badge = document.createElement(\"span\");\n          badge.className = \"plane-count-badge\";\n          btn.appendChild(badge);\n        }\n        if (badge) {\n          if (count > 0) {\n            badge.textContent = String(count);\n            badge.style.display = \"\";\n          } else {\n            badge.style.display = \"none\";\n          }\n        }\n      }\n    }\n  }\n}\n", "import { i18nLocalize as l, i18nLocalizeFormat as lf, notify, getModuleApi, getActiveGmId, MODULE_ID } from \"@helpers\";\nimport { BaseForm } from \"app/shared/features/base/domain/base-form\";\nimport { getEffectiveLayout } from \"app/core/services/planar-layout.service\";\nimport { getActorPlanes, requestTogglePlane, toggleActorPlane, countEnabledPlanes } from \"app/core/services/plane-flags.service\";\nimport { canUserEditPlanes, getCustomBackground, getPlanarIndexWindowSize, setPlanarIndexWindowSize } from \"app/core/services/register.service\";\nimport { emitRefresh } from \"app/core/net/refresh-bus\";\n\nimport type { DeepPartial } from \"fvtt-types/utils\";\nimport type { DefaultOptions, HandlebarsTemplatePart, AppV2RenderOptions, Context } from \"app/shared/features/base/types/base-form.types\";\nimport type { Plane } from \"app/core/types/plane.types\";\nimport type { RefreshEvent } from \"app/core/net/refresh-bus\";\nimport type { PlanarIndexWindowSize } from \"app/core/services/register.service\";\n\ninterface PlanarIndexContext extends Context {\n  actor: Actor;\n  actorName: string;\n  actorId: string;\n  planes: Array<Plane & { enabled: boolean }>;\n  enabledCount: number;\n  totalCount: number;\n  canEdit: boolean;\n  customBackground: string;\n  searchPlaceholder: string;\n}\n\nexport class PlanarIndex extends BaseForm {\n  private actor: Actor;\n  private searchFilter: string = \"\";\n  private zoomLevel: number = 1;\n  private panX: number = 0;\n  private panY: number = 0;\n  private readonly MIN_ZOOM = 0.5;\n  private readonly MAX_ZOOM = 2;\n  private isPanning: boolean = false;\n  private panStartClientX: number = 0;\n  private panStartClientY: number = 0;\n  private panStartX: number = 0;\n  private panStartY: number = 0;\n  private panMoved: boolean = false;\n  private suppressNextClick: boolean = false;\n  private lastWindowSize: PlanarIndexWindowSize;\n  private saveWindowSizeDebounced: (size: PlanarIndexWindowSize) => void;\n\n  constructor(actor: Actor, options?: Partial<DefaultOptions>) {\n    super(options);\n    this.actor = actor;\n    this.lastWindowSize = getPlanarIndexWindowSize();\n    this.saveWindowSizeDebounced = foundry.utils.debounce((size: PlanarIndexWindowSize) => {\n      this.lastWindowSize = size;\n      void setPlanarIndexWindowSize(size);\n    }, 200);\n  }\n\n  override viewId(): string {\n    return \"planar-index\";\n  }\n\n  override refreshKey(): string | undefined {\n    return this.actor.id ?? undefined;\n  }\n\n  static override get DEFAULT_OPTIONS(): DefaultOptions {\n    const base = super.DEFAULT_OPTIONS;\n    const { width, height } = getPlanarIndexWindowSize();\n    return {\n      ...base,\n      id: \"planar-index-app\",\n      classes: [...(base.classes ?? []), \"planar-index\"],\n      window: {\n        ...base.window,\n        title: l(\"ui.title\"),\n        icon: \"fa-solid fa-globe\",\n        resizable: true,\n        minimizable: true,\n      },\n      position: {\n        ...base.position,\n        width,\n        height,\n      },\n    };\n  }\n\n  static override get PARTS(): Record<string, HandlebarsTemplatePart> {\n    const base = super.PARTS;\n    return {\n      ...base,\n      content: {\n        ...base.content,\n        template: `modules/${MODULE_ID}/templates/planar-index/planar-index.hbs`,\n        classes: [\"planar-index-content\"],\n        scrollable: [],\n      },\n    };\n  }\n\n  async _prepareContext(options: DeepPartial<AppV2RenderOptions> & { isFirstRender: boolean }): Promise<PlanarIndexContext> {\n    const actorPlanes = getActorPlanes(this.actor);\n    const user = game.user as User;\n    const canEdit = canUserEditPlanes(user, this.actor);\n    const customBackground = getCustomBackground();\n\n    const layout = getEffectiveLayout();\n    const visibleLayout = layout.filter(plane => !plane.hidden);\n    const visiblePlaneIds = visibleLayout.map(plane => plane.id);\n\n    // Map planes with enabled status\n    const planes = visibleLayout.map(plane => ({\n      ...plane,\n      enabled: actorPlanes[plane.id] === true,\n    }));\n\n    return {\n      actor: this.actor,\n      actorName: this.actor.name ?? \"Unknown\",\n      actorId: this.actor.id ?? \"\",\n      planes,\n      enabledCount: countEnabledPlanes(this.actor, visiblePlaneIds),\n      totalCount: visiblePlaneIds.length,\n      canEdit,\n      customBackground,\n      searchPlaceholder: l(\"ui.searchPlaceholder\"),\n    };\n  }\n\n  async _onRender(context: DeepPartial<PlanarIndexContext>, options: DeepPartial<AppV2RenderOptions>): Promise<void> {\n    await super._onRender(context, options);\n\n    const element = this.element;\n    if (!element) return;\n\n    // Get map container for zoom\n    const mapContainer = element.querySelector<HTMLElement>(\".planar-map-container\");\n\n    // Get all plane nodes\n    const planeNodes = element.querySelectorAll<HTMLElement>(\".plane-node\");\n    console.log(\"[planar-index] Found plane nodes:\", planeNodes.length);\n\n    if (mapContainer) {\n      mapContainer.addEventListener(\"click\", (e: MouseEvent) => {\n        if (this.suppressNextClick) {\n          this.suppressNextClick = false;\n          return;\n        }\n\n        const clickedNode = this._findPlaneNodeAtPoint(e, mapContainer, planeNodes);\n        if (clickedNode) {\n          console.log(\"[planar-index] Found plane at click:\", clickedNode.dataset.planeId);\n          this._onPlaneClick(e, clickedNode);\n        }\n      });\n\n      mapContainer.addEventListener(\n        \"wheel\",\n        (e: WheelEvent) => {\n          e.preventDefault();\n          this._onMapZoom(e, mapContainer);\n        },\n        { passive: false }\n      );\n\n      const onPanEnd = (e: PointerEvent) => {\n        if (!this.isPanning) return;\n\n        this.isPanning = false;\n        mapContainer.classList.remove(\"panning\");\n\n        try {\n          mapContainer.releasePointerCapture(e.pointerId);\n        } catch {\n          // ignore\n        }\n\n        if (this.panMoved) this.suppressNextClick = true;\n      };\n\n      mapContainer.addEventListener(\"pointerdown\", (e: PointerEvent) => {\n        if (e.button !== 0) return;\n\n        const target = e.target as HTMLElement | null;\n        if (target?.closest?.(\".plane-node\")) return;\n\n        e.preventDefault();\n\n        this.isPanning = true;\n        this.panMoved = false;\n        this.panStartClientX = e.clientX;\n        this.panStartClientY = e.clientY;\n        this.panStartX = this.panX;\n        this.panStartY = this.panY;\n\n        mapContainer.classList.add(\"panning\");\n        mapContainer.setPointerCapture(e.pointerId);\n      });\n\n      mapContainer.addEventListener(\"pointermove\", (e: PointerEvent) => {\n        if (!this.isPanning) return;\n\n        e.preventDefault();\n\n        const dx = e.clientX - this.panStartClientX;\n        const dy = e.clientY - this.panStartClientY;\n\n        if (!this.panMoved && Math.hypot(dx, dy) > 4) this.panMoved = true;\n\n        this.panX = this.panStartX + dx;\n        this.panY = this.panStartY + dy;\n        this._applyZoom(mapContainer);\n      });\n\n      mapContainer.addEventListener(\"pointerup\", onPanEnd);\n      mapContainer.addEventListener(\"pointercancel\", onPanEnd);\n\n      const customBg = (context as PlanarIndexContext).customBackground;\n      if (customBg) {\n        mapContainer.style.backgroundImage = `url('${customBg}')`;\n      }\n\n      this._applyZoom(mapContainer);\n\n      const resetBtn = element.querySelector<HTMLButtonElement>(\".planar-reset-btn\");\n      if (resetBtn) {\n        resetBtn.addEventListener(\"click\", e => {\n          e.preventDefault();\n          this._resetView(mapContainer);\n        });\n      }\n    }\n\n    // Bind search input\n    const searchInput = element.querySelector<HTMLInputElement>(\".planar-search-input\");\n    if (searchInput) {\n      searchInput.value = this.searchFilter;\n      searchInput.addEventListener(\"input\", (e: Event) => this._onSearchInput(e, searchInput));\n    }\n\n    // Apply search filter if any\n    if (this.searchFilter) {\n      this._applySearchFilter();\n    }\n  }\n\n  protected override _onPosition(options: DeepPartial<AppV2RenderOptions>): void {\n    super._onPosition(options);\n\n    if (this.minimized) return;\n\n    const { width, height } = this.position;\n    if (typeof width !== \"number\" || typeof height !== \"number\") return;\n\n    const nextSize = { width: Math.round(width), height: Math.round(height) };\n    if (nextSize.width <= 0 || nextSize.height <= 0) return;\n    if (nextSize.width === this.lastWindowSize.width && nextSize.height === this.lastWindowSize.height) return;\n\n    this.saveWindowSizeDebounced(nextSize);\n  }\n\n  private async _onPlaneClick(event: Event, node: HTMLElement): Promise<void> {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const planeId = node.dataset.planeId;\n    console.log(\"[planar-index] _onPlaneClick called, planeId:\", planeId);\n    if (!planeId) return;\n\n    const user = game.user as User;\n    const canEdit = canUserEditPlanes(user, this.actor);\n    console.log(\"[planar-index] canEdit:\", canEdit, \"user.isGM:\", user.isGM);\n\n    if (!canEdit) {\n      notify.warn(l(\"notifications.noPermission\"));\n      return;\n    }\n\n    const currentPlanes = getActorPlanes(this.actor);\n    const currentEnabled = currentPlanes[planeId] === true;\n    const newEnabled = !currentEnabled;\n\n    // Toggle visual state immediately for responsiveness\n    this._updateNodeVisual(node, newEnabled);\n\n    try {\n      if (user.isGM) {\n        // GM can toggle directly\n        await toggleActorPlane(this.actor, planeId, newEnabled, user.id ?? undefined);\n        // Broadcast refresh to all clients\n        emitRefresh({ view: \"planar-index\", key: this.actor.id ?? undefined, reason: \"plane-toggled\" }, { includeSelf: false });\n      } else {\n        // Non-GM needs to request via RPC\n        const success = await requestTogglePlane(this.actor.id ?? \"\", planeId, newEnabled);\n        if (!success) {\n          // Revert visual if failed\n          this._updateNodeVisual(node, currentEnabled);\n          notify.error(l(\"notifications.toggleFailed\"));\n          return;\n        }\n      }\n\n      // Update counter\n      this._updateCounter();\n    } catch (err) {\n      console.error(\"[planar-index] Failed to toggle plane:\", err);\n      // Revert visual on error\n      this._updateNodeVisual(node, currentEnabled);\n      notify.error(l(\"notifications.toggleFailed\"));\n    }\n  }\n\n  private _onPlaneKeydown(event: KeyboardEvent, node: HTMLElement): void {\n    if (event.key === \"Enter\" || event.key === \" \") {\n      event.preventDefault();\n      this._onPlaneClick(event, node);\n    }\n  }\n\n  private _onSearchInput(event: Event, input: HTMLInputElement): void {\n    this.searchFilter = input.value.toLowerCase().trim();\n    this._applySearchFilter();\n  }\n\n  private _applySearchFilter(): void {\n    const element = this.element;\n    if (!element) return;\n\n    const nodes = element.querySelectorAll<HTMLElement>(\".plane-node\");\n    const searchLower = this.searchFilter.toLowerCase();\n\n    nodes.forEach(node => {\n      const planeName = node.dataset.planeName?.toLowerCase() ?? \"\";\n      const matches = searchLower === \"\" || planeName.includes(searchLower);\n\n      if (matches) {\n        node.classList.remove(\"search-hidden\");\n        node.classList.add(\"search-match\");\n      } else {\n        node.classList.add(\"search-hidden\");\n        node.classList.remove(\"search-match\");\n      }\n    });\n  }\n\n  private _updateNodeVisual(node: HTMLElement, enabled: boolean): void {\n    if (enabled) {\n      node.classList.add(\"enabled\");\n      node.classList.remove(\"disabled\");\n      node.setAttribute(\"aria-checked\", \"true\");\n    } else {\n      node.classList.remove(\"enabled\");\n      node.classList.add(\"disabled\");\n      node.setAttribute(\"aria-checked\", \"false\");\n    }\n  }\n\n  private _updateCounter(): void {\n    const element = this.element;\n    if (!element) return;\n\n    const counter = element.querySelector<HTMLElement>(\".plane-counter\");\n    if (counter) {\n      const visiblePlaneIds = getEffectiveLayout()\n        .filter(plane => !plane.hidden)\n        .map(plane => plane.id);\n      const count = countEnabledPlanes(this.actor, visiblePlaneIds);\n      counter.textContent = `${count} / ${visiblePlaneIds.length}`;\n    }\n  }\n\n  private _findPlaneNodeAtPoint(event: MouseEvent, container: HTMLElement, nodes: NodeListOf<HTMLElement>): HTMLElement | null {\n    const containerRect = container.getBoundingClientRect();\n    const clickX = event.clientX - containerRect.left;\n    const clickY = event.clientY - containerRect.top;\n\n    const contentX = (clickX - this.panX) / this.zoomLevel;\n    const contentY = (clickY - this.panY) / this.zoomLevel;\n\n    const hitRadius = 30 / this.zoomLevel;\n\n    for (const node of nodes) {\n      const leftPercent = parseFloat(node.style.left) / 100;\n      const topPercent = parseFloat(node.style.top) / 100;\n\n      const nodeX = leftPercent * containerRect.width;\n      const nodeY = topPercent * containerRect.height;\n\n      const distance = Math.sqrt(Math.pow(contentX - nodeX, 2) + Math.pow(contentY - nodeY, 2));\n\n      if (distance <= hitRadius) return node;\n    }\n\n    return null;\n  }\n\n  private _onMapZoom(event: WheelEvent, container: HTMLElement): void {\n    const containerRect = container.getBoundingClientRect();\n    const mouseX = event.clientX - containerRect.left;\n    const mouseY = event.clientY - containerRect.top;\n\n    const oldZoom = this.zoomLevel;\n    const factor = event.deltaY > 0 ? 0.9 : 1.1;\n    const nextZoom = oldZoom * factor;\n    const newZoom = Math.max(this.MIN_ZOOM, Math.min(this.MAX_ZOOM, nextZoom));\n\n    if (newZoom === oldZoom) return;\n\n    const contentX = (mouseX - this.panX) / oldZoom;\n    const contentY = (mouseY - this.panY) / oldZoom;\n\n    this.zoomLevel = newZoom;\n    this.panX = mouseX - contentX * newZoom;\n    this.panY = mouseY - contentY * newZoom;\n\n    this._applyZoom(container);\n  }\n\n  private _applyZoom(container: HTMLElement): void {\n    const content = container.querySelector<HTMLElement>(\".planar-map-content\");\n    if (!content) return;\n\n    content.style.transform = `translate(${this.panX}px, ${this.panY}px) scale(${this.zoomLevel})`;\n    content.style.transformOrigin = \"0 0\";\n  }\n\n  private _resetView(container: HTMLElement): void {\n    this.zoomLevel = 1;\n    this.panX = 0;\n    this.panY = 0;\n    this._applyZoom(container);\n  }\n\n  protected override async handleRefresh(ev: RefreshEvent): Promise<void> {\n    // Re-render on refresh\n    await this.render(true);\n  }\n\n  /**\n   * Get the actor this UI is managing\n   */\n  getActor(): Actor {\n    return this.actor;\n  }\n}\n\n/**\n * Open the Planar Index UI for an actor\n */\nexport function openPlanarIndex(actor: Actor): void {\n  const app = new PlanarIndex(actor);\n  app.render(true);\n}\n", "import { getModuleApi, requireGmOrThrow } from \"@helpers\";\nimport { toggleActorPlane, getActorPlanes } from \"app/core/services/plane-flags.service\";\nimport { canUserEditPlanes } from \"app/core/services/register.service\";\nimport { emitRefresh } from \"app/core/net/refresh-bus\";\n\nimport type { TogglePlanePayload, TogglePlaneResponse, GetPlanesPayload, GetPlanesResponse } from \"app/core/types/plane.types\";\n\n/**\n * Register GM-only RPC handlers for plane operations.\n * These handlers should only be registered on the GM client.\n */\nexport function registerGmPlanarRpc(): void {\n  if (!game.user?.isGM) return;\n\n  const moduleApi = getModuleApi() as ModuleAPI;\n  const ws = moduleApi.werewolfSocket;\n\n  // Handle plane toggle requests\n  ws.on(\"pi:plane:toggle\", async env => {\n    requireGmOrThrow();\n\n    const payload = env.payload as TogglePlanePayload;\n    const { actorId, planeId, enabled } = payload;\n\n    // Get the actor\n    const actor = game.actors?.get(actorId);\n    if (!actor) {\n      console.warn(`[planar-index] Actor ${actorId} not found`);\n      return { success: false, actorId, planeId, enabled: false } as TogglePlaneResponse;\n    }\n\n    // Verify the requesting user has permission\n    const requestingUser = game.users?.get(env.sender);\n    if (requestingUser && !canUserEditPlanes(requestingUser, actor)) {\n      console.warn(`[planar-index] User ${env.sender} lacks permission to edit planes on ${actorId}`);\n      return { success: false, actorId, planeId, enabled: false } as TogglePlaneResponse;\n    }\n\n    try {\n      // Perform the toggle\n      await toggleActorPlane(actor, planeId, enabled, env.sender);\n\n      // Broadcast refresh to all clients\n      emitRefresh({ view: \"planar-index\", key: actorId, reason: \"plane-toggled\" }, { includeSelf: true });\n\n      // Also emit actor-specific refresh for header buttons\n      emitRefresh({ view: \"planar-index-header\", key: actorId, reason: \"plane-toggled\" }, { includeSelf: true });\n\n      return { success: true, actorId, planeId, enabled } as TogglePlaneResponse;\n    } catch (err) {\n      console.error(`[planar-index] Failed to toggle plane:`, err);\n      return { success: false, actorId, planeId, enabled: false } as TogglePlaneResponse;\n    }\n  });\n\n  // Handle get planes requests\n  ws.on(\"pi:planes:get\", async env => {\n    const payload = env.payload as GetPlanesPayload;\n    const { actorId } = payload;\n\n    const actor = game.actors?.get(actorId);\n    if (!actor) {\n      console.warn(`[planar-index] Actor ${actorId} not found`);\n      return { actorId, planes: {} } as GetPlanesResponse;\n    }\n\n    const planes = getActorPlanes(actor);\n    return { actorId, planes } as GetPlanesResponse;\n  });\n\n  // Handle bulk set planes requests\n  ws.on(\"pi:planes:set\", async env => {\n    requireGmOrThrow();\n\n    const payload = env.payload as { actorId: string; planes: Record<string, boolean> };\n    const { actorId, planes } = payload;\n\n    const actor = game.actors?.get(actorId);\n    if (!actor) {\n      console.warn(`[planar-index] Actor ${actorId} not found`);\n      return { success: false };\n    }\n\n    // Verify the requesting user has permission\n    const requestingUser = game.users?.get(env.sender);\n    if (requestingUser && !canUserEditPlanes(requestingUser, actor)) {\n      console.warn(`[planar-index] User ${env.sender} lacks permission to edit planes on ${actorId}`);\n      return { success: false };\n    }\n\n    try {\n      const { setActorPlanes } = await import(\"app/core/services/plane-flags.service\");\n      await setActorPlanes(actor, planes, env.sender);\n\n      // Broadcast refresh to all clients\n      emitRefresh({ view: \"planar-index\", key: actorId, reason: \"planes-updated\" }, { includeSelf: true });\n\n      emitRefresh({ view: \"planar-index-header\", key: actorId, reason: \"planes-updated\" }, { includeSelf: true });\n\n      return { success: true };\n    } catch (err) {\n      console.error(`[planar-index] Failed to set planes:`, err);\n      return { success: false };\n    }\n  });\n\n  console.log(\"[planar-index] GM RPC handlers registered\");\n}\n"],
  "mappings": ";;;;;;;;;;;AA6BO,SAAS,SAAS,SAAS,IAAI;AACpC,SAAO,QAAQ,MAAM,SAAS,MAAM;AACtC;AASO,SAAS,aAAa,KAAa,WAAmB,IAAY;AACvE,SAAQ,KAAc,MAAM,SAAS,GAAG,SAAS,IAAI,GAAG,EAAE,KAAK;AACjE;AAEO,SAAS,mBAAmB,KAAa,QAAgC,WAAmB,IAAY;AAC7G,SAAQ,KAAc,MAAM,OAAO,GAAG,SAAS,IAAI,GAAG,IAAI,MAAM,KAAK;AACvE;AAEO,SAAS,UAAU,UAAkB,WAAW;AACrD,QAAM,SAAU,KAAc,SAAS,IAAI,OAAO;AAClD,MAAI,CAAC,QAAQ;AACX,UAAM,IAAI,MAAM,UAAU,OAAO,YAAY;AAAA,EAC/C;AACA,SAAO;AACT;AAEO,SAAS,aAA6B,UAAkB,WAA6B;AAC1F,QAAM,SAAS,UAAU,OAAO;AAChC,SAAO,OAAO;AAChB;AAEO,SAAS,4BAA4B;AAC1C,MAAI;AACF,UAAM,KAAM,WAAmB;AAC/B,QAAI,CAAC,IAAI;AACP,cAAQ,KAAK,0DAA0D;AACvE;AAAA,IACF;AAEA,QAAI,CAAC,GAAG,SAAS,UAAU;AACzB,SAAG,eAAe,YAAY,CAAC,MAAW,QAAa;AACrD,cAAM,QAAQ,OAAO,GAAG,KAAK;AAC7B,YAAI,QAAQ,KAAM,QAAO;AACzB,cAAM,IAAI,OAAO,IAAI;AACrB,YAAI,EAAE,UAAU,MAAO,QAAO;AAC9B,eAAO,GAAG,EAAE,MAAM,GAAG,KAAK,EAAE,QAAQ,CAAC;AAAA,MACvC,CAAC;AAAA,IACH;AAAA,EACF,SAAS,KAAK;AACZ,YAAQ,MAAM,yDAAyD,GAAG;AAAA,EAC5E;AACF;AAEO,SAAS,gBAAoC;AAClD,QAAM,SAAS,KAAK,OAAO,KAAK,OAAK,EAAE,UAAU,EAAE,IAAI,GAAG;AAC1D,MAAI,OAAQ,QAAO;AACnB,SAAO,KAAK,OAAO,KAAK,OAAK,EAAE,IAAI,GAAG;AACxC;AAEO,SAAS,mBAAmB;AACjC,MAAI,CAAC,KAAK,MAAM,KAAM,OAAM,IAAI,MAAM,yCAAyC;AACjF;AA3FA,IAAa,uBAEA,WAEE,UAEA,WAEF,YAEA;AAVb;AAAA;AAAA;AAAO,IAAM,wBAAN,cAAoC,QAAQ,aAAa,IAAI,2BAA2B,QAAQ,aAAa,IAAI,aAAa,EAAE;AAAA,IAAC;AAEjI,IAAM,YAAY;AAElB,KAAM,EAAE,aAAa,QAAQ,aAAa;AAE1C,KAAM,EAAE,cAAc,QAAQ;AAE9B,IAAM,aAAc,QAAQ,aAAa,KAAa,WAAW;AAEjE,IAAM,SAAS;AAAA,MACpB,KAAK,KAAmB;AACtB,aAAK,IAAI,eAAe,KAAK,GAAG;AAAA,MAClC;AAAA,MACA,MAAM,KAAmB;AACvB,aAAK,IAAI,eAAe,MAAM,GAAG;AAAA,MACnC;AAAA,MACA,QAAQ,KAAmB;AACzB,aAAK,IAAI,eAAe,QAAQ,GAAG;AAAA,MACrC;AAAA,MACA,KAAK,KAAmB;AACtB,aAAK,IAAI,eAAe,KAAK,GAAG;AAAA,MAClC;AAAA,IACF;AAAA;AAAA;;;ACvBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASO,SAAS,eAAe,OAAuC;AACpE,QAAM,QAAQ,MAAM,QAAQ,WAAW,QAAQ;AAC/C,SAAO,SAAS,CAAC;AACnB;AAKO,SAAS,mBAAmB,OAAkE;AACnG,QAAM,OAAO,MAAM,QAAQ,WAAW,aAAa;AACnD,SAAO,QAAQ,CAAC;AAClB;AAKO,SAAS,eAAe,OAAc,SAA0B;AACrE,QAAM,SAAS,eAAe,KAAK;AACnC,SAAO,OAAO,OAAO,MAAM;AAC7B;AAMA,eAAsB,eAAe,OAAc,QAAiC,QAAgC;AAClH,QAAM,MAAM,QAAQ,WAAW,UAAU,MAAM;AAC/C,QAAM,MAAM,QAAQ,WAAW,eAAe;AAAA,IAC5C,eAAe,UAAU,KAAK,MAAM;AAAA,IACpC,eAAe,KAAK,IAAI;AAAA,EAC1B,CAAC;AACH;AAKA,eAAsB,iBAAiB,OAAc,SAAiB,SAAkB,QAAgC;AACtH,QAAM,SAAS,eAAe,KAAK;AACnC,SAAO,OAAO,IAAI;AAClB,QAAM,eAAe,OAAO,QAAQ,MAAM;AAC5C;AAKA,eAAsB,mBAAmB,SAAiB,SAAiB,SAAoC;AAC7G,QAAM,YAAY,aAAa;AAC/B,QAAM,KAAK,UAAU;AACrB,QAAM,OAAO,cAAc;AAE3B,MAAI,CAAC,MAAM;AACT,UAAM,IAAI,MAAM,oCAAoC;AAAA,EACtD;AAEA,MAAI;AACF,UAAM,SAAS,MAAM,GAAG;AAAA,MACtB;AAAA,MACA,EAAE,SAAS,SAAS,QAAQ;AAAA,MAC5B,EAAE,cAAc,MAAM,UAAU,KAAK,MAAM,KAAK;AAAA,IAClD;AACA,WAAO,OAAO;AAAA,EAChB,SAAS,KAAK;AACZ,YAAQ,MAAM,kDAAkD,GAAG;AACnE,WAAO;AAAA,EACT;AACF;AAKO,SAAS,mBAAmB,OAAc,UAA6B;AAC5E,QAAM,SAAS,eAAe,KAAK;AACnC,MAAI,CAAC,SAAU,QAAO,OAAO,OAAO,MAAM,EAAE,OAAO,OAAO,EAAE;AAC5D,SAAO,SAAS,OAAO,CAAC,OAAO,OAAO,SAAS,OAAO,EAAE,IAAI,IAAI,IAAI,CAAC;AACvE;AAKO,SAAS,mBAAmB,OAAwB;AACzD,QAAM,SAAS,eAAe,KAAK;AACnC,SAAO,OAAO,QAAQ,MAAM,EACzB,OAAO,CAAC,CAAC,EAAE,OAAO,MAAM,OAAO,EAC/B,IAAI,CAAC,CAAC,EAAE,MAAM,EAAE;AACrB;AA7FA,IAGM,UACA;AAJN;AAAA;AAAA;AAAA;AAGA,IAAM,WAAW;AACjB,IAAM,gBAAgB;AAAA;AAAA;;;ACaf,IAAM,aAAa,CAAC,MAAyB,CAAC,CAAC,EAAE,YAAY,CAAC,CAAC,EAAE;;;AChBxE;AAEO,IAAM,UAAU,UAAU,SAAS;AAEnC,IAAM,wBAAN,MAA4B;AAAA,EASjC,YAAY,SAAiB;AAP7B,SAAQ,aAAa,oBAAI,IAAqC;AAC9D,SAAQ,eAAe,CAAC,SAAmB,KAAK,SAAS,IAAI;AAG7D,SAAiB,YAAY,oBAAI,IAA0B;AAC3D,SAAiB,cAA4B,CAAC;AAG5C,SAAK,UAAU;AAAA,EACjB;AAAA,EAEA,OAAa;AACX,SAAK,SAAS,KAAK;AACnB,SAAK,QAAQ,GAAG,KAAK,SAAS,KAAK,YAAY;AAAA,EACjD;AAAA,EAEA,UAAgB;AACd,SAAK,QAAQ,IAAI,KAAK,SAAS,KAAK,YAAY;AAChD,SAAK,UAAU,MAAM;AACrB,SAAK,WAAW,MAAM;AAAA,EACxB;AAAA,EAEA,IAAI,IAAsB;AACxB,SAAK,YAAY,KAAK,EAAE;AAAA,EAC1B;AAAA,EAEA,GAAG,MAAc,SAA8B;AAC7C,UAAM,MAAM,KAAK,UAAU,IAAI,IAAI,KAAK,oBAAI,IAAa;AACzD,QAAI,IAAI,OAAO;AACf,SAAK,UAAU,IAAI,MAAM,GAAG;AAC5B,WAAO,MAAM;AACX,UAAI,OAAO,OAAO;AAAA,IACpB;AAAA,EACF;AAAA,EAEA,IAAI,MAAc,SAAkB;AAClC,SAAK,UAAU,IAAI,IAAI,GAAG,OAAO,OAAO;AAAA,EAC1C;AAAA,EAEA,KAAK,MAAc,SAAmB,MAAqD;AACzF,UAAM,MAAgB;AAAA,MACpB;AAAA,MACA;AAAA,MACA,QAAQ,KAAK,MAAM,MAAM;AAAA,MACzB,cAAc,MAAM;AAAA,IACtB;AACA,SAAK,QAAQ,KAAK,KAAK,SAAS,GAAG;AACnC,QAAI,MAAM,aAAa,MAAO,MAAK,SAAS,GAAG;AAAA,EACjD;AAAA,EAEA,QAAqB,MAAc,SAAmB,MAAsF;AAC1I,UAAM,YAAY,SAAS;AAC3B,UAAM,MAAgB;AAAA,MACpB;AAAA,MACA;AAAA,MACA,QAAQ,KAAK,MAAM,MAAM;AAAA,MACzB,cAAc,MAAM;AAAA,MACpB;AAAA,IACF;AAEA,UAAM,YAAY,MAAM,aAAa;AAErC,WAAO,IAAI,QAAW,CAAC,SAAS,WAAW;AACzC,YAAM,UAAU,CAAC,gBAA0B;AACzC,YAAI,YAAY,cAAc,aAAa,CAAC,YAAY,SAAU;AAClE,aAAK,WAAW,OAAO,SAAS;AAChC,YAAI,YAAY,SAAS,GAAI,SAAQ,YAAY,SAAS,IAAS;AAAA,YAC9D,QAAO,IAAI,MAAM,YAAY,SAAS,SAAS,oBAAoB,CAAC;AAAA,MAC3E;AAEA,WAAK,WAAW,IAAI,WAAW,OAAO;AACtC,WAAK,QAAQ,GAAG,KAAK,SAAS,OAAO;AAErC,WAAK,QAAQ,KAAK,KAAK,SAAS,GAAG;AACnC,UAAI,MAAM,aAAa,MAAO,MAAK,SAAS,GAAG;AAE/C,iBAAW,MAAM;AACf,YAAI,CAAC,KAAK,WAAW,IAAI,SAAS,EAAG;AACrC,aAAK,QAAQ,IAAI,KAAK,SAAS,OAAO;AACtC,aAAK,WAAW,OAAO,SAAS;AAChC,eAAO,IAAI,MAAM,uBAAuB,CAAC;AAAA,MAC3C,GAAG,SAAS;AAAA,IACd,CAAC;AAAA,EACH;AAAA,EAEA,MAAc,SAAS,KAAe;AACpC,QAAI,IAAI,gBAAgB,IAAI,iBAAiB,KAAK,MAAM,GAAI;AAE5D,QAAI,WAAW,GAAG,KAAK,IAAI,WAAW;AACpC,YAAM,SAAS,KAAK,WAAW,IAAI,IAAI,SAAS;AAChD,UAAI,QAAQ;AACV,aAAK,QAAQ,IAAI,KAAK,SAAS,MAAM;AACrC,eAAO,GAAG;AAAA,MACZ;AACA;AAAA,IACF;AAEA,UAAM,QAAQ,CAAC,GAAG,KAAK,WAAW;AAClC,QAAI,MAAM;AACV,UAAM,MAAM,YAAY;AACtB;AACA,UAAI,MAAM,MAAM,QAAQ;AACtB,cAAM,MAAM,GAAG,EAAE,KAAK,GAAG;AAAA,MAC3B,OAAO;AACL,cAAM,MAAM,KAAK,UAAU,IAAI,IAAI,IAAI;AACvC,YAAI,CAAC,OAAO,IAAI,SAAS,EAAG;AAC5B,YAAI,WAAW;AACf,mBAAW,WAAW,KAAK;AACzB,gBAAM,SAAS,MAAM,QAAQ,GAAG;AAChC,cAAI,IAAI,aAAa,WAAW,UAAa,CAAC,UAAU;AACtD,uBAAW;AACX,iBAAK,MAAM,KAAK,EAAE,IAAI,MAAM,MAAM,OAAO,CAAC;AAAA,UAC5C;AAAA,QACF;AACA,YAAI,IAAI,aAAa,CAAC,SAAU,MAAK,MAAM,KAAK,EAAE,IAAI,KAAK,CAAC;AAAA,MAC9D;AAAA,IACF;AACA,QAAI;AACF,YAAM,IAAI;AAAA,IACZ,SAAS,KAAU;AACjB,UAAI,IAAI,UAAW,MAAK,MAAM,KAAK,EAAE,IAAI,OAAO,OAAO,KAAK,WAAW,OAAO,GAAG,EAAE,CAAC;AAAA,UAC/E,SAAQ,MAAM,oCAAoC,IAAI,IAAI,EAAE;AAAA,IACnE;AAAA,EACF;AAAA,EAEQ,MAAM,IAAc,UAA6C;AACvE,UAAM,cAAwB;AAAA,MAC5B,MAAM,GAAG;AAAA,MACT,QAAQ,KAAK,MAAM,MAAM;AAAA,MACzB,cAAc,GAAG;AAAA,MACjB,WAAW,GAAG;AAAA,MACd;AAAA,IACF;AACA,SAAK,QAAQ,KAAK,KAAK,SAAS,WAAW;AAC3C,QAAI,GAAG,WAAW,KAAK,MAAM,IAAI;AAC/B,WAAK,SAAS,WAAW;AAAA,IAC3B;AAAA,EACF;AACF;;;AChJA;;;ACDA;;;ACAA;;;ACAA;AAMO,IAAe,WAAf,cAAgC,sBAAmD;AAAA,EACxF;AAAA,EACA,gBAAgB;AAAA,EAEhB,SAAiB;AACf,WAAO,KAAK,YAAY;AAAA,EAC1B;AAAA,EACA,aAAiC;AAC/B,WAAO;AAAA,EACT;AAAA,EAEA,WAAW,kBAAkC;AAC3C,WAAO;AAAA,MACL,SAAS,CAAC;AAAA,MACV,KAAK;AAAA,MACL,QAAQ;AAAA,QACN,OAAO;AAAA,QACP,YAAY;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,QACN,UAAU,CAAC;AAAA,QACX,aAAa;AAAA,QACb,WAAW;AAAA,QACX,YAAY;AAAA,QACZ,gBAAgB,CAAC;AAAA,MACnB;AAAA,MACA,SAAS,CAAC;AAAA,MACV,MAAM;AAAA,QACJ,SAAS;AAAA,QACT,gBAAgB;AAAA,QAChB,eAAe;AAAA,MACjB;AAAA,MACA,UAAU;AAAA,QACR,OAAO;AAAA,QACP,QAAQ;AAAA,MACV;AAAA,IACF;AAAA,EACF;AAAA,EAEA,WAAW,QAAgD;AACzD,WAAO;AAAA,MACL,SAAS;AAAA,QACP,UAAU;AAAA,QACV,SAAS,CAAC;AAAA,QACV,YAAY,CAAC;AAAA,MACf;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,gBAAgB,SAAyF;AAC7G,WAAO,CAAC;AAAA,EACV;AAAA,EAEA,MAAM,UAAU,SAA+B,SAAyD;AACtG,UAAM,YAAY,aAAa;AAC/B,UAAM,KAAK,UAAU;AAErB,QAAI,CAAC,KAAK,eAAe;AACvB,WAAK,gBAAgB;AACrB,WAAK,cAAc,GAAG,GAAG,cAAc,OAAM,QAAO;AAClD,cAAM,KAAK,IAAI;AACf,YAAI,CAAC,GAAI;AACT,YAAI,GAAG,SAAS,KAAK,OAAO,EAAG;AAE/B,cAAM,QAAQ,KAAK,WAAW;AAC9B,YAAI,GAAG,OAAO,SAAS,GAAG,QAAQ,MAAO;AAEzC,YAAI;AACF,gBAAM,KAAK,cAAc,EAAE;AAAA,QAC7B,SAAS,KAAK;AACZ,kBAAQ,MAAM,qCAAqC,KAAK,OAAO,CAAC,KAAK,GAAG;AAAA,QAC1E;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEA,MAAgB,cAAc,IAAkB;AAC9C,UAAM,KAAK,OAAO,IAAI;AAAA,EACxB;AAAA,EAEA,MAAM,MAAM,SAAyF;AACnG,QAAI;AACF,UAAI,KAAK,YAAa,MAAK,YAAY;AACvC,aAAO,MAAM,MAAM,MAAM,OAAO;AAAA,IAClC,UAAE;AACA,WAAK,cAAc;AACnB,WAAK,gBAAgB;AAAA,IACvB;AAAA,EACF;AACF;;;AC/FA;AAQO,SAAS,YAAY,IAAkB,MAAyD;AACrG,QAAM,YAAY,aAAa;AAC/B,QAAM,KAAK,UAAU;AAErB,KAAG,KAAK,cAAc,IAAI;AAAA,IACxB,cAAc,MAAM,gBAAgB;AAAA,IACpC,UAAU,MAAM,gBAAgB;AAAA,EAClC,CAAC;AACH;;;AChBA;;;ACKO,SAAS,QAAQ,MAAsB;AAC5C,SAAO,KACJ,YAAY,EACZ,QAAQ,QAAQ,GAAG,EACnB,QAAQ,eAAe,EAAE;AAC9B;AAKA,SAAS,MAAM,MAAc,GAAW,GAAW,WAA0B,SAAgB;AAC3F,SAAO;AAAA,IACL,IAAI,QAAQ,IAAI;AAAA,IAChB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;AAYO,IAAM,gBAAyB;AAAA;AAAA,EAEpC,MAAM,aAAa,KAAK,MAAM,OAAO;AAAA;AAAA,EAGrC,MAAM,WAAW,MAAM,MAAM,OAAO;AAAA,EACpC,MAAM,YAAY,MAAM,MAAM,OAAO;AAAA,EACrC,MAAM,aAAa,MAAM,MAAM,OAAO;AAAA,EACtC,MAAM,YAAY,MAAM,MAAM,OAAO;AAAA,EACrC,MAAM,gBAAgB,MAAM,MAAM,OAAO;AAAA,EACzC,MAAM,YAAY,MAAM,MAAM,OAAO;AAAA,EACrC,MAAM,UAAU,KAAK,MAAM,OAAO;AAAA;AAAA,EAGlC,MAAM,UAAU,MAAM,MAAM,OAAO;AAAA,EACnC,MAAM,YAAY,MAAM,MAAM,OAAO;AAAA,EACrC,MAAM,YAAY,MAAM,MAAM,OAAO;AAAA,EACrC,MAAM,UAAU,MAAM,MAAM,OAAO;AAAA,EACnC,MAAM,SAAS,MAAM,MAAM,OAAO;AAAA,EAClC,MAAM,UAAU,MAAM,MAAM,OAAO;AAAA,EACnC,MAAM,cAAc,MAAM,MAAM,OAAO;AAAA,EACvC,MAAM,YAAY,MAAM,MAAM,OAAO;AAAA,EACrC,MAAM,YAAY,MAAM,MAAM,OAAO;AAAA,EACrC,MAAM,YAAY,MAAM,MAAM,OAAO;AAAA,EACrC,MAAM,UAAU,MAAM,MAAM,OAAO;AAAA,EACnC,MAAM,YAAY,KAAK,MAAM,OAAO;AAAA,EACpC,MAAM,cAAc,MAAM,MAAM,OAAO;AAAA,EACvC,MAAM,eAAe,MAAM,MAAM,OAAO;AAAA;AAAA,EAGxC,MAAM,SAAS,MAAM,MAAM,OAAO;AAAA,EAClC,MAAM,SAAS,MAAM,MAAM,OAAO;AAAA,EAClC,MAAM,aAAa,MAAM,MAAM,OAAO;AAAA,EACtC,MAAM,YAAY,MAAM,MAAM,OAAO;AAAA,EACrC,MAAM,QAAQ,MAAM,MAAM,OAAO;AAAA,EACjC,MAAM,YAAY,MAAM,MAAM,OAAO;AAAA,EACrC,MAAM,UAAU,MAAM,KAAK,OAAO;AAAA,EAClC,MAAM,WAAW,MAAM,MAAM,OAAO;AAAA,EACpC,MAAM,WAAW,MAAM,MAAM,OAAO;AAAA,EACpC,MAAM,YAAY,MAAM,MAAM,OAAO;AAAA,EACrC,MAAM,WAAW,MAAM,MAAM,OAAO;AAAA,EACpC,MAAM,aAAa,MAAM,KAAK,OAAO;AAAA,EACrC,MAAM,WAAW,MAAM,MAAM,OAAO;AAAA,EACpC,MAAM,SAAS,MAAM,MAAM,OAAO;AAAA,EAClC,MAAM,YAAY,MAAM,KAAK,OAAO;AAAA,EACpC,MAAM,WAAW,MAAM,MAAM,OAAO;AAAA,EACpC,MAAM,YAAY,MAAM,KAAK,OAAO;AAAA,EACpC,MAAM,YAAY,MAAM,MAAM,OAAO;AAAA;AAAA,EAGrC,MAAM,MAAM,MAAM,MAAM,OAAO;AAAA,EAC/B,MAAM,YAAY,MAAM,MAAM,OAAO;AAAA,EACrC,MAAM,WAAW,MAAM,KAAK,OAAO;AAAA,EACnC,MAAM,SAAS,MAAM,MAAM,OAAO;AAAA,EAClC,MAAM,QAAQ,KAAK,MAAM,OAAO;AAAA,EAChC,MAAM,WAAW,MAAM,MAAM,OAAO;AAAA,EACpC,MAAM,oBAAoB,MAAM,MAAM,OAAO;AAAA;AAAA,EAG7C,MAAM,oBAAoB,KAAK,MAAM,SAAS;AAChD;AAKO,IAAM,eAAsC,cAAc;AAAA,EAC/D,CAAC,KAAKA,WAAU;AACd,QAAIA,OAAM,EAAE,IAAIA;AAChB,WAAO;AAAA,EACT;AAAA,EACA,CAAC;AACH;AAKO,IAAM,gBAA0B,cAAc,IAAI,OAAK,EAAE,EAAE;AAK3D,SAAS,uBAA6D;AAC3E,QAAM,SAAmB,CAAC;AAC1B,QAAM,UAAU,oBAAI,IAAY;AAEhC,aAAWA,UAAS,eAAe;AAEjC,QAAI,QAAQ,IAAIA,OAAM,EAAE,GAAG;AACzB,aAAO,KAAK,uBAAuBA,OAAM,EAAE,EAAE;AAAA,IAC/C;AACA,YAAQ,IAAIA,OAAM,EAAE;AAGpB,QAAIA,OAAM,IAAI,KAAKA,OAAM,IAAI,GAAG;AAC9B,aAAO,KAAK,SAASA,OAAM,EAAE,8BAA8BA,OAAM,CAAC,EAAE;AAAA,IACtE;AACA,QAAIA,OAAM,IAAI,KAAKA,OAAM,IAAI,GAAG;AAC9B,aAAO,KAAK,SAASA,OAAM,EAAE,8BAA8BA,OAAM,CAAC,EAAE;AAAA,IACtE;AAGA,QAAI,CAACA,OAAM,QAAQA,OAAM,KAAK,KAAK,MAAM,IAAI;AAC3C,aAAO,KAAK,SAASA,OAAM,EAAE,iBAAiB;AAAA,IAChD;AAAA,EACF;AAGA,QAAM,gBAAgB;AACtB,MAAI,cAAc,WAAW,eAAe;AAC1C,WAAO,KAAK,YAAY,aAAa,kBAAkB,cAAc,MAAM,EAAE;AAAA,EAC/E;AAEA,SAAO;AAAA,IACL,OAAO,OAAO,WAAW;AAAA,IACzB;AAAA,EACF;AACF;;;AD/IA,IAAM,mBAAoC,CAAC,SAAS,SAAS,SAAS;AAEtE,SAAS,cAAc,QAAoC;AACzD,MAAI,CAAC,OAAQ,QAAO;AACpB,QAAM,SAAS,MAAM,QAAQ,MAAM,IAAI,SAAS,OAAO;AACvD,SAAO,MAAM,QAAQ,MAAM,IAAI,SAAS;AAC1C;AAEA,SAAS,eAAeC,QAAqB;AAC3C,SAAO;AAAA,IACL,GAAGA;AAAA,IACH,UAAUA,OAAM,YAAY;AAAA,IAC5B,QAAQA,OAAM,WAAW;AAAA,EAC3B;AACF;AAEA,SAAS,gBAAgB,QAA0B;AACjD,SAAO,OAAO,IAAI,cAAc;AAClC;AAEO,SAAS,iBAAiB,MAAsB;AACrD,SAAO,QAAQ,IAAI;AACrB;AAEO,SAAS,mBAA4B;AAC1C,SAAO,gBAAgB,UAAU,aAAa,CAAY;AAC5D;AAEO,SAAS,kBAAkC;AAChD,QAAM,IAAI;AACV,QAAM,MAAM,EAAE,SAAS,IAAI,WAAW,cAAc,kBAAkB;AACtE,QAAM,SAAS,cAAc,GAAG;AAChC,MAAI,CAAC,OAAQ,QAAO;AAEpB,QAAM,aAAa,gBAAgB,UAAU,MAAM,CAAY;AAC/D,QAAM,aAAa,eAAe,UAAU;AAC5C,MAAI,CAAC,WAAW,OAAO;AACrB,YAAQ,KAAK,mEAAmE,WAAW,MAAM;AACjG,WAAO;AAAA,EACT;AAEA,SAAO;AACT;AAEO,SAAS,qBAA8B;AAC5C,SAAO,gBAAgB,KAAK,iBAAiB;AAC/C;AAEA,eAAsB,iBAAiB,QAA+C;AACpF,mBAAiB;AACjB,QAAM,IAAI;AACV,QAAM,SAAS,cAAc,MAAM;AACnC,MAAI,CAAC,OAAQ,OAAM,IAAI,MAAM,8BAA8B;AAE3D,QAAM,aAAa,gBAAgB,UAAU,MAAM,CAAY;AAC/D,QAAM,aAAa,eAAe,UAAU;AAC5C,MAAI,CAAC,WAAW,MAAO,OAAM,IAAI,MAAM,WAAW,OAAO,KAAK,IAAI,CAAC;AAEnE,QAAM,EAAE,SAAS,IAAI,WAAW,cAAc,oBAAoB,EAAE,QAAQ,WAAW,CAAC;AAC1F;AAEA,eAAsB,uBAAsC;AAC1D,mBAAiB;AACjB,QAAM,IAAI;AACV,QAAM,EAAE,SAAS,IAAI,WAAW,cAAc,oBAAoB,IAAI;AACxE;AAEO,SAAS,eAAe,QAAsE;AACnG,QAAM,SAAS,cAAc,MAAM;AACnC,MAAI,CAAC,OAAQ,QAAO,EAAE,OAAO,OAAO,QAAQ,CAAC,8BAA8B,EAAE;AAE7E,QAAM,SAAmB,CAAC;AAC1B,QAAM,OAAO,oBAAI,IAAY;AAE7B,aAAWA,UAAS,QAAQ;AAC1B,UAAM,MAAMA,OAAM,MAAM,IAAI,KAAK;AACjC,UAAM,QAAQA,OAAM,QAAQ,IAAI,KAAK;AAErC,QAAI,CAAC,GAAI,QAAO,KAAK,oBAAoB;AACzC,QAAI,CAAC,KAAM,QAAO,KAAK,SAAS,MAAM,WAAW,kBAAkB;AAEnE,QAAI,IAAI;AACN,UAAI,KAAK,IAAI,EAAE,EAAG,QAAO,KAAK,uBAAuB,EAAE,EAAE;AACzD,WAAK,IAAI,EAAE;AAAA,IACb;AAEA,QAAI,CAAC,OAAO,SAASA,OAAM,CAAC,EAAG,QAAO,KAAK,SAAS,MAAM,WAAW,mBAAmBA,OAAM,CAAC,EAAE;AACjG,QAAI,CAAC,OAAO,SAASA,OAAM,CAAC,EAAG,QAAO,KAAK,SAAS,MAAM,WAAW,mBAAmBA,OAAM,CAAC,EAAE;AAEjG,QAAI,OAAO,SAASA,OAAM,CAAC,MAAMA,OAAM,IAAI,KAAKA,OAAM,IAAI,IAAI;AAC5D,aAAO,KAAK,SAAS,MAAM,WAAW,qBAAqBA,OAAM,CAAC,EAAE;AAAA,IACtE;AACA,QAAI,OAAO,SAASA,OAAM,CAAC,MAAMA,OAAM,IAAI,KAAKA,OAAM,IAAI,IAAI;AAC5D,aAAO,KAAK,SAAS,MAAM,WAAW,qBAAqBA,OAAM,CAAC,EAAE;AAAA,IACtE;AAEA,QAAIA,OAAM,YAAY,CAAC,iBAAiB,SAASA,OAAM,QAAQ,GAAG;AAChE,aAAO,KAAK,SAAS,MAAM,WAAW,0BAA0BA,OAAM,QAAQ,EAAE;AAAA,IAClF;AAAA,EACF;AAEA,SAAO,EAAE,OAAO,OAAO,WAAW,GAAG,OAAO;AAC9C;;;AHxEO,IAAM,qBAAN,cAAiC,SAAS;AAAA,EAA1C;AAAA;AACL,SAAQ,SAAkB,CAAC;AAC3B,SAAQ,kBAAkB;AAC1B,SAAQ,cAAc;AACtB,SAAQ,eAAe;AACvB,SAAQ,WAAqB;AAG7B,SAAQ,YAAY;AACpB,SAAQ,OAAO;AACf,SAAQ,OAAO;AACf,SAAiB,WAAW;AAC5B,SAAiB,WAAW;AAC5B,SAAQ,YAAY;AACpB,SAAQ,kBAAkB;AAC1B,SAAQ,kBAAkB;AAC1B,SAAQ,YAAY;AACpB,SAAQ,YAAY;AACpB,SAAQ,WAAW;AAEnB,SAAQ,kBAAkB;AAG1B,SAAQ,mBAAmB;AAC3B,SAAQ,mBAAmB;AAC3B,SAAQ,YAAY;AAAA;AAAA,EAEX,SAAiB;AACxB,WAAO;AAAA,EACT;AAAA,EAEA,WAAoB,kBAAkC;AACpD,UAAM,OAAO,MAAM;AACnB,WAAO;AAAA,MACL,GAAG;AAAA,MACH,IAAI;AAAA,MACJ,SAAS,CAAC,GAAI,KAAK,WAAW,CAAC,GAAI,sBAAsB;AAAA,MACzD,QAAQ;AAAA,QACN,GAAG,KAAK;AAAA,QACR,OAAO,aAAE,uBAAuB;AAAA,QAChC,MAAM;AAAA,QACN,WAAW;AAAA,QACX,aAAa;AAAA,MACf;AAAA,MACA,UAAU;AAAA,QACR,GAAG,KAAK;AAAA,QACR,OAAO;AAAA,QACP,QAAQ;AAAA,MACV;AAAA,IACF;AAAA,EACF;AAAA,EAEA,WAAoB,QAAgD;AAClE,UAAM,OAAO,MAAM;AACnB,WAAO;AAAA,MACL,GAAG;AAAA,MACH,SAAS;AAAA,QACP,GAAG,KAAK;AAAA,QACR,UAAU,WAAW,SAAS;AAAA,QAC9B,SAAS,CAAC,8BAA8B;AAAA,QACxC,YAAY,CAAC;AAAA,MACf;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAe,gBAAgB,SAA2G;AACxI,UAAM,OAAO,KAAK,MAAM,QAAQ;AAChC,QAAI,KAAK,eAAe,KAAK,OAAO,WAAW,EAAG,MAAK,yBAAyB;AAEhF,UAAM,SAAS,KAAK,OAAO,IAAI,CAAAC,YAAU;AAAA,MACvC,GAAGA;AAAA,MACH,QAAQA,OAAM,WAAW;AAAA,MACzB,UAAUA,OAAM,OAAO,KAAK;AAAA,IAC9B,EAAE;AAEF,UAAM,YAAY,KAAK,mBAAmB,EAAE,IAAI,CAAAA,YAAU;AAAA,MACxD,GAAGA;AAAA,MACH,QAAQA,OAAM,WAAW;AAAA,MACzB,UAAUA,OAAM,OAAO,KAAK;AAAA,IAC9B,EAAE;AAEF,UAAM,cAAwD;AAAA,MAC5D,EAAE,OAAO,WAAW,OAAO,aAAE,8BAA8B,GAAG,UAAU,KAAK,aAAa,UAAU;AAAA,MACpG,EAAE,OAAO,QAAQ,OAAO,aAAE,2BAA2B,GAAG,UAAU,KAAK,aAAa,OAAO;AAAA,MAC3F,EAAE,OAAO,YAAY,OAAO,aAAE,+BAA+B,GAAG,UAAU,KAAK,aAAa,WAAW;AAAA,IACzG;AAEA,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA,iBAAiB,KAAK;AAAA,MACtB,mBAAmB,KAAK,kBAAkB,aAAE,+BAA+B,IAAI,aAAE,gCAAgC;AAAA,MACjH,mBAAmB,aAAE,sBAAsB;AAAA,MAC3C;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAe,UAAU,SAAiD,SAAyD;AACjI,UAAM,MAAM,UAAU,SAAS,OAAO;AAEtC,QAAI,CAAC,KAAK,MAAM,MAAM;AACpB,aAAO,KAAK,aAAE,sBAAsB,CAAC;AACrC,YAAM,KAAK,MAAM;AACjB;AAAA,IACF;AAEA,UAAM,UAAU,KAAK;AACrB,QAAI,CAAC,QAAS;AAEd,UAAM,eAAe,QAAQ,cAA2B,uBAAuB;AAC/E,QAAI,cAAc;AAChB,WAAK,oBAAoB,YAAY;AACrC,WAAK,UAAU,YAAY;AAAA,IAC7B;AAEA,SAAK,mBAAmB,OAAO;AAC/B,SAAK,kBAAkB;AACvB,SAAK,eAAe;AAAA,EACtB;AAAA,EAEQ,2BAAiC;AACvC,SAAK,SAAS,mBAAmB;AACjC,SAAK,kBAAkB,gBAAgB,MAAM;AAC7C,SAAK,cAAc;AACnB,SAAK,kBAAkB;AAAA,EACzB;AAAA,EAEQ,oBAA0B;AAChC,QAAI,KAAK,mBAAmB,CAAC,KAAK,OAAO,KAAK,CAAAA,WAASA,OAAM,OAAO,KAAK,eAAe,GAAG;AACzF,WAAK,kBAAkB;AAAA,IACzB;AAAA,EACF;AAAA,EAEQ,qBAA8B;AACpC,UAAM,SAAS,CAAC,GAAG,KAAK,MAAM;AAC9B,QAAI,KAAK,aAAa,QAAQ;AAC5B,aAAO,OAAO,KAAK,CAAC,GAAG,MAAM,EAAE,KAAK,cAAc,EAAE,IAAI,CAAC;AAAA,IAC3D;AACA,QAAI,KAAK,aAAa,YAAY;AAChC,YAAM,QAAuC,EAAE,OAAO,GAAG,OAAO,GAAG,SAAS,EAAE;AAC9E,aAAO,OAAO,KAAK,CAAC,GAAG,OAAO,MAAM,EAAE,YAAY,OAAO,KAAK,OAAO,MAAM,EAAE,YAAY,OAAO,KAAK,OAAO,EAAE,KAAK,cAAc,EAAE,IAAI,CAAC;AAAA,IAC1I;AACA,WAAO;AAAA,EACT;AAAA,EAEQ,oBAAoB,WAA8B;AACxD,UAAM,QAAQ,UAAU,iBAA8B,qBAAqB;AAC3E,UAAM,QAAQ,UAAQ;AACpB,WAAK,iBAAiB,eAAe,CAAC,MAAoB,KAAK,mBAAmB,GAAG,MAAM,SAAS,CAAC;AAAA,IACvG,CAAC;AAED,cAAU;AAAA,MACR;AAAA,MACA,CAAC,MAAkB;AACjB,UAAE,eAAe;AACjB,aAAK,UAAU,GAAG,SAAS;AAAA,MAC7B;AAAA,MACA,EAAE,SAAS,MAAM;AAAA,IACnB;AAEA,cAAU,iBAAiB,eAAe,CAAC,MAAoB,KAAK,iBAAiB,GAAG,SAAS,CAAC;AAClG,cAAU,iBAAiB,eAAe,CAAC,MAAoB,KAAK,iBAAiB,GAAG,SAAS,CAAC;AAClG,cAAU,iBAAiB,aAAa,CAAC,MAAoB,KAAK,gBAAgB,GAAG,SAAS,CAAC;AAC/F,cAAU,iBAAiB,iBAAiB,CAAC,MAAoB,KAAK,gBAAgB,GAAG,SAAS,CAAC;AAEnG,UAAM,WAAW,KAAK,SAAS,cAAiC,uBAAuB;AACvF,QAAI,UAAU;AACZ,eAAS,iBAAiB,SAAS,OAAK;AACtC,UAAE,eAAe;AACjB,aAAK,UAAU,SAAS;AAAA,MAC1B,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEQ,mBAAmB,SAA4B;AACrD,UAAM,cAAc,QAAQ,cAAgC,6BAA6B;AACzF,QAAI,aAAa;AACf,kBAAY,QAAQ,KAAK;AACzB,kBAAY,iBAAiB,SAAS,MAAM;AAC1C,aAAK,eAAe,YAAY,MAAM,YAAY,EAAE,KAAK;AACzD,aAAK,kBAAkB;AAAA,MACzB,CAAC;AAAA,IACH;AAEA,UAAM,aAAa,QAAQ,cAAiC,4BAA4B;AACxF,QAAI,YAAY;AACd,iBAAW,QAAQ,KAAK;AACxB,iBAAW,iBAAiB,UAAU,MAAM;AAC1C,aAAK,WAAY,WAAW,SAAsB;AAClD,aAAK,KAAK,OAAO;AAAA,MACnB,CAAC;AAAA,IACH;AAEA,YAAQ,cAAiC,yBAAyB,GAAG,iBAAiB,SAAS,MAAM,KAAK,KAAK,WAAW,CAAC;AAC3H,YAAQ,cAAiC,2BAA2B,GAAG,iBAAiB,SAAS,MAAM,KAAK,KAAK,aAAa,CAAC;AAC/H,YAAQ,cAAiC,2BAA2B,GAAG,iBAAiB,SAAS,MAAM,KAAK,KAAK,iBAAiB,CAAC;AACnI,YAAQ,cAAiC,0BAA0B,GAAG,iBAAiB,SAAS,MAAM,KAAK,KAAK,YAAY,CAAC;AAC7H,YAAQ,cAAiC,2BAA2B,GAAG,iBAAiB,SAAS,MAAM,KAAK,KAAK,aAAa,CAAC;AAC/H,YAAQ,cAAiC,2BAA2B,GAAG,iBAAiB,SAAS,MAAM,KAAK,KAAK,aAAa,CAAC;AAE/H,UAAM,OAAO,QAAQ,cAA2B,2BAA2B;AAC3E,QAAI,MAAM;AACR,WAAK,iBAAiB,SAAS,OAAK;AAClC,cAAM,SAAS,EAAE;AACjB,YAAI,CAAC,OAAQ;AAEb,cAAM,YAAY,OAAO,QAA2B,eAAe;AACnE,YAAI,WAAW;AACb,YAAE,eAAe;AACjB,gBAAM,UAAU,UAAU,QAAQ;AAClC,gBAAM,SAAS,UAAU,QAAQ;AACjC,cAAI,CAAC,WAAW,CAAC,OAAQ;AACzB,cAAI,WAAW,OAAQ,MAAK,KAAK,eAAe,OAAO;AACvD,cAAI,WAAW,gBAAiB,MAAK,kBAAkB,OAAO;AAC9D,cAAI,WAAW,SAAU,MAAK,KAAK,YAAY,OAAO;AACtD;AAAA,QACF;AAEA,cAAM,OAAO,OAAO,QAAqB,kBAAkB;AAC3D,YAAI,MAAM,SAAS,SAAS;AAC1B,eAAK,mBAAmB,KAAK,QAAQ,OAAO;AAAA,QAC9C;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEQ,mBAAmB,OAAqB,MAAmB,WAA8B;AAC/F,QAAI,MAAM,WAAW,EAAG;AACxB,UAAM,eAAe;AACrB,UAAM,gBAAgB;AAEtB,UAAM,UAAU,KAAK,QAAQ;AAC7B,QAAI,CAAC,QAAS;AAEd,SAAK,kBAAkB;AACvB,SAAK,cAAc;AACnB,SAAK,gBAAgB;AACrB,SAAK,YAAY;AACjB,SAAK,mBAAmB,MAAM;AAC9B,SAAK,mBAAmB,MAAM;AAE9B,SAAK,mBAAmB,OAAO;AAE/B,SAAK,UAAU,IAAI,UAAU;AAC7B,cAAU,kBAAkB,MAAM,SAAS;AAAA,EAC7C;AAAA,EAEQ,iBAAiB,OAAqB,WAA8B;AAC1E,QAAI,MAAM,WAAW,EAAG;AACxB,QAAK,MAAM,QAA+B,UAAU,qBAAqB,EAAG;AAE5E,UAAM,eAAe;AAErB,SAAK,YAAY;AACjB,SAAK,WAAW;AAChB,SAAK,kBAAkB,MAAM;AAC7B,SAAK,kBAAkB,MAAM;AAC7B,SAAK,YAAY,KAAK;AACtB,SAAK,YAAY,KAAK;AAEtB,cAAU,UAAU,IAAI,SAAS;AACjC,cAAU,kBAAkB,MAAM,SAAS;AAAA,EAC7C;AAAA,EAEQ,iBAAiB,OAAqB,WAA8B;AAC1E,QAAI,KAAK,iBAAiB;AACxB,YAAM,eAAe;AACrB,UAAI,CAAC,KAAK,eAAe,CAAC,KAAK,cAAe;AAE9C,YAAMC,MAAK,MAAM,UAAU,KAAK;AAChC,YAAMC,MAAK,MAAM,UAAU,KAAK;AAChC,UAAI,CAAC,KAAK,aAAa,KAAK,MAAMD,KAAIC,GAAE,IAAI,EAAG,MAAK,YAAY;AAEhE,YAAM,EAAE,GAAG,EAAE,IAAI,KAAK,6BAA6B,OAAO,SAAS;AACnE,WAAK,oBAAoB,KAAK,aAAa,GAAG,GAAG,KAAK,aAAa;AACnE;AAAA,IACF;AAEA,QAAI,CAAC,KAAK,UAAW;AAErB,UAAM,eAAe;AAErB,UAAM,KAAK,MAAM,UAAU,KAAK;AAChC,UAAM,KAAK,MAAM,UAAU,KAAK;AAChC,QAAI,CAAC,KAAK,YAAY,KAAK,MAAM,IAAI,EAAE,IAAI,EAAG,MAAK,WAAW;AAE9D,SAAK,OAAO,KAAK,YAAY;AAC7B,SAAK,OAAO,KAAK,YAAY;AAC7B,SAAK,UAAU,SAAS;AAAA,EAC1B;AAAA,EAEQ,gBAAgB,OAAqB,WAA8B;AACzE,QAAI,KAAK,iBAAiB;AACxB,WAAK,kBAAkB;AACvB,WAAK,cAAc;AACnB,WAAK,eAAe,UAAU,OAAO,UAAU;AAC/C,WAAK,gBAAgB;AACrB,UAAI;AACF,kBAAU,sBAAsB,MAAM,SAAS;AAAA,MACjD,QAAQ;AAAA,MAER;AACA;AAAA,IACF;AAEA,QAAI,CAAC,KAAK,UAAW;AACrB,SAAK,YAAY;AACjB,cAAU,UAAU,OAAO,SAAS;AACpC,QAAI;AACF,gBAAU,sBAAsB,MAAM,SAAS;AAAA,IACjD,QAAQ;AAAA,IAER;AAAA,EACF;AAAA,EAEQ,UAAU,OAAmB,WAA8B;AACjE,UAAM,OAAO,UAAU,sBAAsB;AAC7C,UAAM,SAAS,MAAM,UAAU,KAAK;AACpC,UAAM,SAAS,MAAM,UAAU,KAAK;AAEpC,UAAM,UAAU,KAAK;AACrB,UAAM,SAAS,MAAM,SAAS,IAAI,MAAM;AACxC,UAAM,WAAW,UAAU;AAC3B,UAAM,UAAU,KAAK,IAAI,KAAK,UAAU,KAAK,IAAI,KAAK,UAAU,QAAQ,CAAC;AACzE,QAAI,YAAY,QAAS;AAEzB,UAAM,YAAY,SAAS,KAAK,QAAQ;AACxC,UAAM,YAAY,SAAS,KAAK,QAAQ;AAExC,SAAK,YAAY;AACjB,SAAK,OAAO,SAAS,WAAW;AAChC,SAAK,OAAO,SAAS,WAAW;AAChC,SAAK,UAAU,SAAS;AAAA,EAC1B;AAAA,EAEQ,UAAU,WAA8B;AAC9C,UAAM,UAAU,UAAU,cAA2B,qBAAqB;AAC1E,QAAI,CAAC,QAAS;AACd,YAAQ,MAAM,YAAY,aAAa,KAAK,IAAI,OAAO,KAAK,IAAI,aAAa,KAAK,SAAS;AAC3F,YAAQ,MAAM,kBAAkB;AAAA,EAClC;AAAA,EAEQ,UAAU,WAA8B;AAC9C,SAAK,YAAY;AACjB,SAAK,OAAO;AACZ,SAAK,OAAO;AACZ,SAAK,UAAU,SAAS;AAAA,EAC1B;AAAA,EAEQ,6BAA6B,OAAqB,WAAkD;AAC1G,UAAM,OAAO,UAAU,sBAAsB;AAC7C,UAAM,SAAS,MAAM,UAAU,KAAK;AACpC,UAAM,SAAS,MAAM,UAAU,KAAK;AAEpC,UAAM,YAAY,SAAS,KAAK,QAAQ,KAAK;AAC7C,UAAM,YAAY,SAAS,KAAK,QAAQ,KAAK;AAE7C,WAAO;AAAA,MACL,GAAG,KAAK,MAAM,WAAW,KAAK,OAAO,GAAG,CAAC;AAAA,MACzC,GAAG,KAAK,MAAM,WAAW,KAAK,QAAQ,GAAG,CAAC;AAAA,IAC5C;AAAA,EACF;AAAA,EAEQ,oBAAoB,SAAiB,GAAW,GAAW,MAA0B;AAC3F,UAAMF,SAAQ,KAAK,OAAO,KAAK,OAAK,EAAE,OAAO,OAAO;AACpD,QAAI,CAACA,OAAO;AAEZ,IAAAA,OAAM,IAAI;AACV,IAAAA,OAAM,IAAI;AAEV,UAAM,aAAa,QAAQ,KAAK,SAAS,cAA2B,sCAAsC,OAAO,IAAI;AACrH,QAAI,YAAY;AACd,iBAAW,MAAM,OAAO,GAAG,IAAI,GAAG;AAClC,iBAAW,MAAM,MAAM,GAAG,IAAI,GAAG;AAAA,IACnC;AAAA,EACF;AAAA,EAEQ,oBAA0B;AAChC,UAAM,UAAU,KAAK;AACrB,QAAI,CAAC,QAAS;AAEd,UAAM,cAAc,KAAK,aAAa,YAAY;AAClD,UAAM,QAAQ,QAAQ,iBAA8B,qBAAqB;AACzE,UAAM,YAAY,QAAQ,iBAA8B,kBAAkB;AAE1E,UAAM,QAAQ,UAAQ;AACpB,YAAM,YAAY,KAAK,QAAQ,WAAW,YAAY,KAAK;AAC3D,YAAM,UAAU,gBAAgB,MAAM,UAAU,SAAS,WAAW;AACpE,WAAK,UAAU,OAAO,iBAAiB,CAAC,OAAO;AAC/C,WAAK,UAAU,OAAO,gBAAgB,WAAW,gBAAgB,EAAE;AAAA,IACrE,CAAC;AAED,cAAU,QAAQ,UAAQ;AACxB,YAAM,YAAY,KAAK,QAAQ,WAAW,YAAY,KAAK;AAC3D,YAAM,UAAU,gBAAgB,MAAM,UAAU,SAAS,WAAW;AACpE,WAAK,UAAU,OAAO,iBAAiB,CAAC,OAAO;AAAA,IACjD,CAAC;AAAA,EACH;AAAA,EAEQ,iBAAuB;AAC7B,QAAI,CAAC,KAAK,gBAAiB;AAC3B,SAAK,mBAAmB,KAAK,eAAe;AAAA,EAC9C;AAAA,EAEQ,mBAAmB,SAAwB;AACjD,SAAK,kBAAkB;AACvB,UAAM,UAAU,KAAK;AACrB,QAAI,CAAC,QAAS;AAEd,YAAQ,iBAA8B,qBAAqB,EAAE,QAAQ,UAAQ;AAC3E,WAAK,UAAU,OAAO,eAAe,KAAK,QAAQ,YAAY,OAAO;AAAA,IACvE,CAAC;AACD,YAAQ,iBAA8B,kBAAkB,EAAE,QAAQ,UAAQ;AACxE,WAAK,UAAU,OAAO,eAAe,KAAK,QAAQ,YAAY,OAAO;AAAA,IACvE,CAAC;AAAA,EACH;AAAA,EAEQ,MAAM,OAAe,KAAa,KAAqB;AAC7D,WAAO,KAAK,IAAI,KAAK,KAAK,IAAI,KAAK,KAAK,CAAC;AAAA,EAC3C;AAAA,EAEQ,oBAAoB,OAAe,UAA0B;AACnE,QAAI,CAAC,OAAO,SAAS,KAAK,EAAG,QAAO;AACpC,WAAO,KAAK,MAAM,OAAO,GAAG,CAAC;AAAA,EAC/B;AAAA,EAEA,MAAc,mBAAkC;AAC9C,UAAM,UAAU,KAAK,sBAAsB;AAAA,MACzC,MAAM;AAAA,MACN,MAAM;AAAA,MACN,IAAI;AAAA,MACJ,UAAU;AAAA,MACV,GAAG;AAAA,MACH,GAAG;AAAA,MACH,QAAQ;AAAA,IACV,CAAC;AAED,UAAM,SAAU,MAAM,SAAS,OAAO;AAAA,MACpC,QAAQ,EAAE,OAAO,aAAE,oCAAoC,GAAG,WAAW,MAAM;AAAA,MAC3E;AAAA,MACA,IAAI;AAAA,QACF,OAAO,aAAE,gCAAgC;AAAA,QACzC,MAAM;AAAA,QACN,UAAU,CAAC,MAAkC,QAA2B,KAAK,mBAAmB,IAAI,IAAI;AAAA,MAC1G;AAAA,MACA,QAAQ;AAAA,QACN,OAAO,aAAE,gCAAgC;AAAA,QACzC,UAAU,MAAM;AAAA,MAClB;AAAA,MACA,aAAa;AAAA,IACf,CAAC;AAED,QAAI,CAAC,OAAQ;AAEb,UAAM,OAAO,OAAO,KAAK,KAAK;AAC9B,QAAI,CAAC,KAAM,QAAO,OAAO,MAAM,aAAE,iCAAiC,CAAC;AAEnE,UAAM,cAAc,iBAAiB,IAAI;AACzC,UAAM,MAAM,OAAO,GAAG,KAAK,KAAK,aAAa,KAAK;AAClD,QAAI,CAAC,GAAI,QAAO,OAAO,MAAM,aAAE,+BAA+B,CAAC;AAC/D,QAAI,KAAK,OAAO,KAAK,CAAAA,WAASA,OAAM,OAAO,EAAE,GAAG;AAC9C,aAAO,OAAO,MAAM,mBAAG,mCAAmC,EAAE,GAAG,CAAC,CAAC;AAAA,IACnE;AAEA,UAAMA,SAAe;AAAA,MACnB;AAAA,MACA;AAAA,MACA,UAAU,KAAK,kBAAkB,OAAO,QAAQ;AAAA,MAChD,GAAG,KAAK,oBAAoB,OAAO,GAAG,GAAG;AAAA,MACzC,GAAG,KAAK,oBAAoB,OAAO,GAAG,GAAG;AAAA,MACzC,QAAQ,OAAO;AAAA,IACjB;AAEA,SAAK,OAAO,KAAKA,MAAK;AACtB,SAAK,kBAAkBA,OAAM;AAC7B,UAAM,KAAK,OAAO;AAAA,EACpB;AAAA,EAEA,MAAc,eAAe,SAAgC;AAC3D,UAAMA,SAAQ,KAAK,OAAO,KAAK,OAAK,EAAE,OAAO,OAAO;AACpD,QAAI,CAACA,OAAO;AAEZ,UAAM,UAAU,KAAK,sBAAsB;AAAA,MACzC,MAAM;AAAA,MACN,MAAMA,OAAM;AAAA,MACZ,IAAIA,OAAM;AAAA,MACV,UAAUA,OAAM,YAAY;AAAA,MAC5B,GAAGA,OAAM;AAAA,MACT,GAAGA,OAAM;AAAA,MACT,QAAQA,OAAM,WAAW;AAAA,IAC3B,CAAC;AAED,UAAM,SAAU,MAAM,SAAS,OAAO;AAAA,MACpC,QAAQ,EAAE,OAAO,aAAE,kCAAkC,GAAG,WAAW,MAAM;AAAA,MACzE;AAAA,MACA,IAAI;AAAA,QACF,OAAO,aAAE,8BAA8B;AAAA,QACvC,MAAM;AAAA,QACN,UAAU,CAAC,MAAkC,QAA2B,KAAK,mBAAmB,IAAI,IAAI;AAAA,MAC1G;AAAA,MACA,QAAQ;AAAA,QACN,OAAO,aAAE,gCAAgC;AAAA,QACzC,UAAU,MAAM;AAAA,MAClB;AAAA,MACA,aAAa;AAAA,IACf,CAAC;AAED,QAAI,CAAC,OAAQ;AAEb,UAAM,OAAO,OAAO,KAAK,KAAK;AAC9B,QAAI,CAAC,KAAM,QAAO,OAAO,MAAM,aAAE,iCAAiC,CAAC;AAEnE,IAAAA,OAAM,OAAO;AACb,IAAAA,OAAM,WAAW,KAAK,kBAAkB,OAAO,QAAQ;AACvD,IAAAA,OAAM,SAAS,OAAO;AACtB,IAAAA,OAAM,IAAI,KAAK,oBAAoB,OAAO,GAAGA,OAAM,CAAC;AACpD,IAAAA,OAAM,IAAI,KAAK,oBAAoB,OAAO,GAAGA,OAAM,CAAC;AAEpD,UAAM,KAAK,OAAO;AAAA,EACpB;AAAA,EAEQ,mBAAmB,MAAuD;AAChF,QAAI,CAAC,KAAM,QAAO;AAClB,UAAM,WAAW,KAAK;AACtB,UAAM,OAAO,OAAO,SAAS,MAAM,SAAS,EAAE;AAC9C,UAAM,KAAK,OAAO,SAAS,IAAI,SAAS,EAAE;AAC1C,UAAM,WAAW,OAAO,SAAS,UAAU,SAAS,OAAO;AAC3D,UAAM,IAAI,OAAO,SAAS,GAAG,SAAS,CAAC;AACvC,UAAM,IAAI,OAAO,SAAS,GAAG,SAAS,CAAC;AACvC,UAAM,SAAS,QAAQ,SAAS,QAAQ,OAAO;AAC/C,WAAO,EAAE,MAAM,IAAI,UAAU,GAAG,GAAG,OAAO;AAAA,EAC5C;AAAA,EAEQ,kBAAkB,UAAiD;AACzE,QAAI,aAAa,WAAW,aAAa,WAAW,aAAa,UAAW,QAAO;AACnF,WAAO;AAAA,EACT;AAAA,EAEQ,sBAAsB,MAQnB;AACT,UAAM,MAAM,QAAQ,MAAM;AAC1B,UAAM,OAAO,IAAI,KAAK,QAAQ,EAAE;AAChC,UAAM,KAAK,IAAI,KAAK,MAAM,EAAE;AAC5B,UAAM,IAAI,OAAO,SAAS,KAAK,CAAC,IAAI,KAAK,EAAE,QAAQ,CAAC,IAAI;AACxD,UAAM,IAAI,OAAO,SAAS,KAAK,CAAC,IAAI,KAAK,EAAE,QAAQ,CAAC,IAAI;AACxD,UAAM,SAAS,KAAK,SAAS;AAC7B,UAAM,SAAS,SAAS,aAAE,iCAAiC,IAAI,aAAE,+BAA+B;AAEhG,WAAO;AAAA;AAAA;AAAA,oCAGyB,aAAE,6BAA6B,CAAC;AAAA;AAAA,oEAEA,IAAI;AAAA;AAAA;AAAA;AAAA,kCAItC,aAAE,2BAA2B,CAAC;AAAA;AAAA,gEAEA,EAAE,KAAK,SAAS,aAAa,EAAE;AAAA;AAAA,6BAElE,MAAM;AAAA;AAAA;AAAA,wCAGK,aAAE,iCAAiC,CAAC;AAAA;AAAA;AAAA,sCAGtC,KAAK,aAAa,UAAU,aAAa,EAAE,IAAI,aAAE,iBAAiB,CAAC;AAAA,sCACnE,KAAK,aAAa,UAAU,aAAa,EAAE,IAAI,aAAE,iBAAiB,CAAC;AAAA,wCACjE,KAAK,aAAa,YAAY,aAAa,EAAE,IAAI,aAAE,mBAAmB,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,iCAK9E,aAAE,0BAA0B,CAAC;AAAA;AAAA,4FAE8B,CAAC;AAAA;AAAA;AAAA;AAAA,iCAI5D,aAAE,0BAA0B,CAAC;AAAA;AAAA,4FAE8B,CAAC;AAAA;AAAA;AAAA;AAAA,sCAIvD,aAAE,+BAA+B,CAAC;AAAA;AAAA,qEAEH,KAAK,SAAS,YAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,EAK/F;AAAA,EAEA,MAAc,YAAY,SAAgC;AACxD,UAAMA,SAAQ,KAAK,OAAO,KAAK,OAAK,EAAE,OAAO,OAAO;AACpD,QAAI,CAACA,OAAO;AAEZ,UAAM,YAAY,MAAM,SAAS,QAAQ;AAAA,MACvC,QAAQ,EAAE,OAAO,aAAE,oCAAoC,EAAE;AAAA,MACzD,SAAS,MAAM,mBAAG,wCAAwC,EAAE,MAAM,QAAQ,MAAM,WAAWA,OAAM,IAAI,EAAE,CAAC,CAAC;AAAA,MACzG,aAAa;AAAA,IACf,CAAC;AAED,QAAI,CAAC,UAAW;AAEhB,SAAK,SAAS,KAAK,OAAO,OAAO,OAAK,EAAE,OAAO,OAAO;AACtD,QAAI,KAAK,oBAAoB,QAAS,MAAK,kBAAkB;AAC7D,UAAM,KAAK,OAAO;AAAA,EACpB;AAAA,EAEQ,kBAAkB,SAAuB;AAC/C,UAAMA,SAAQ,KAAK,OAAO,KAAK,OAAK,EAAE,OAAO,OAAO;AACpD,QAAI,CAACA,OAAO;AACZ,IAAAA,OAAM,SAAS,CAACA,OAAM;AACtB,SAAK,KAAK,OAAO;AAAA,EACnB;AAAA,EAEA,MAAc,aAA4B;AACxC,UAAM,aAAa,eAAe,KAAK,MAAM;AAC7C,QAAI,CAAC,WAAW,OAAO;AACrB,aAAO,MAAM,mBAAG,+BAA+B,EAAE,QAAQ,WAAW,OAAO,KAAK,IAAI,EAAE,CAAC,CAAC;AACxF;AAAA,IACF;AAEA,QAAI;AACF,YAAM,iBAAiB,KAAK,MAAM;AAClC,WAAK,cAAc;AACnB,WAAK,yBAAyB;AAC9B,aAAO,QAAQ,aAAE,2BAA2B,CAAC;AAC7C,WAAK,kBAAkB,gBAAgB;AACvC,YAAM,KAAK,OAAO;AAAA,IACpB,SAAS,KAAU;AACjB,aAAO,MAAM,mBAAG,kCAAkC,EAAE,OAAO,KAAK,WAAW,OAAO,GAAG,EAAE,CAAC,CAAC;AAAA,IAC3F;AAAA,EACF;AAAA,EAEA,MAAc,eAA8B;AAC1C,SAAK,cAAc;AACnB,UAAM,KAAK,OAAO;AAAA,EACpB;AAAA,EAEA,MAAc,cAA6B;AACzC,UAAM,YAAY,MAAM,SAAS,QAAQ;AAAA,MACvC,QAAQ,EAAE,OAAO,aAAE,mCAAmC,EAAE;AAAA,MACxD,SAAS,MAAM,aAAE,qCAAqC,CAAC;AAAA,MACvD,aAAa;AAAA,IACf,CAAC;AACD,QAAI,CAAC,UAAW;AAEhB,UAAM,qBAAqB;AAC3B,SAAK,SAAS,iBAAiB;AAC/B,SAAK,kBAAkB;AACvB,SAAK,kBAAkB;AACvB,WAAO,QAAQ,aAAE,2BAA2B,CAAC;AAC7C,SAAK,kBAAkB,cAAc;AACrC,UAAM,KAAK,OAAO;AAAA,EACpB;AAAA,EAEA,MAAc,eAA8B;AAC1C,UAAM,UAAU,KAAK,UAAU,EAAE,QAAQ,KAAK,OAAO,GAAG,MAAM,CAAC;AAC/D,QAAI;AACF,UAAI,UAAU,WAAW,WAAW;AAClC,cAAM,UAAU,UAAU,UAAU,OAAO;AAC3C,eAAO,QAAQ,aAAE,4BAA4B,CAAC;AAC9C;AAAA,MACF;AAAA,IACF,QAAQ;AAAA,IAER;AAEA,UAAM,UAAU,QAAQ,MAAM,WAAW,OAAO;AAChD,UAAM,SAAS,OAAO;AAAA,MACpB,QAAQ,EAAE,OAAO,aAAE,oCAAoC,GAAG,WAAW,KAAK;AAAA,MAC1E,SAAS;AAAA;AAAA;AAAA,oFAGqE,OAAO;AAAA;AAAA;AAAA;AAAA,MAIrF,IAAI;AAAA,QACF,OAAO,aAAE,+BAA+B;AAAA,QACxC,MAAM;AAAA,QACN,UAAU,MAAM;AAAA,MAClB;AAAA,MACA,QAAQ;AAAA,QACN,OAAO,aAAE,gCAAgC;AAAA,QACzC,UAAU,MAAM;AAAA,MAClB;AAAA,MACA,aAAa;AAAA,IACf,CAAC;AAAA,EACH;AAAA,EAEA,MAAc,eAA8B;AAC1C,UAAM,SAAU,MAAM,SAAS,OAAO;AAAA,MACpC,QAAQ,EAAE,OAAO,aAAE,oCAAoC,GAAG,WAAW,KAAK;AAAA,MAC1E,SAAS;AAAA;AAAA;AAAA,uCAGwB,aAAE,mCAAmC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,MAKvE,IAAI;AAAA,QACF,OAAO,aAAE,gCAAgC;AAAA,QACzC,MAAM;AAAA,QACN,UAAU,CAAC,MAAkC,QAA2B;AACtE,gBAAM,QAAQ,OAAQ,IAAI,MAAM,WAAmB,aAAa,GAAG,SAAS,EAAE;AAC9E,iBAAO,MAAM,KAAK;AAAA,QACpB;AAAA,MACF;AAAA,MACA,QAAQ;AAAA,QACN,OAAO,aAAE,gCAAgC;AAAA,QACzC,UAAU,MAAM;AAAA,MAClB;AAAA,MACA,aAAa;AAAA,IACf,CAAC;AAED,QAAI,CAAC,OAAQ;AAEb,QAAI;AACJ,QAAI;AACF,eAAS,KAAK,MAAM,MAAM;AAAA,IAC5B,SAAS,KAAU;AACjB,aAAO,MAAM,mBAAG,oCAAoC,EAAE,OAAO,KAAK,WAAW,eAAe,CAAC,CAAC;AAC9F;AAAA,IACF;AAEA,UAAM,SAAS,MAAM,QAAQ,MAAM,IAAI,SAAU,QAAgB;AACjE,QAAI,CAAC,MAAM,QAAQ,MAAM,GAAG;AAC1B,aAAO,MAAM,aAAE,mCAAmC,CAAC;AACnD;AAAA,IACF;AAEA,UAAM,aAAa,eAAe,MAAiB;AACnD,QAAI,CAAC,WAAW,OAAO;AACrB,aAAO,MAAM,mBAAG,+BAA+B,EAAE,QAAQ,WAAW,OAAO,KAAK,IAAI,EAAE,CAAC,CAAC;AACxF;AAAA,IACF;AAEA,QAAI;AACF,YAAM,iBAAiB,MAAiB;AACxC,WAAK,cAAc;AACnB,WAAK,yBAAyB;AAC9B,aAAO,QAAQ,aAAE,8BAA8B,CAAC;AAChD,WAAK,kBAAkB,iBAAiB;AACxC,YAAM,KAAK,OAAO;AAAA,IACpB,SAAS,KAAU;AACjB,aAAO,MAAM,mBAAG,kCAAkC,EAAE,OAAO,KAAK,WAAW,OAAO,GAAG,EAAE,CAAC,CAAC;AAAA,IAC3F;AAAA,EACF;AAAA,EAEQ,kBAAkB,QAAsB;AAC9C,gBAAY,EAAE,MAAM,gBAAgB,OAAO,GAAG,EAAE,aAAa,KAAK,CAAC;AAAA,EACrE;AACF;;;AD7xBO,IAAM,gBAAgB;AAAA,EAC3B,gBAAgB;AAAA,EAChB,iBAAiB;AAAA,EACjB,kBAAkB;AAAA,EAClB,uBAAuB;AAAA,EACvB,oBAAoB;AACtB;AAOO,IAAM,4BAAmD;AAAA,EAC9D,OAAO;AAAA,EACP,QAAQ;AACV;AAKO,SAAS,mBAAyB;AACvC,QAAM,IAAI;AAGV,IAAE,SAAS,SAAS,WAAW,cAAc,gBAAgB;AAAA,IAC3D,MAAM,aAAE,8BAA8B;AAAA,IACtC,MAAM,aAAE,8BAA8B;AAAA,IACtC,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,SAAS;AAAA,MACP,IAAI,aAAE,oCAAoC;AAAA,MAC1C,SAAS,aAAE,yCAAyC;AAAA,MACpD,KAAK,aAAE,qCAAqC;AAAA,IAC9C;AAAA,IACA,SAAS;AAAA,IACT,gBAAgB;AAAA,EAClB,CAAC;AAGD,IAAE,SAAS,SAAS,WAAW,cAAc,iBAAiB;AAAA,IAC5D,MAAM,aAAE,+BAA+B;AAAA,IACvC,MAAM,aAAE,+BAA+B;AAAA,IACvC,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,SAAS;AAAA,IACT,gBAAgB;AAAA,EAClB,CAAC;AAGD,IAAE,SAAS,SAAS,WAAW,cAAc,kBAAkB;AAAA,IAC7D,MAAM,aAAE,gCAAgC;AAAA,IACxC,MAAM,aAAE,gCAAgC;AAAA,IACxC,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,SAAS;AAAA,IACT,gBAAgB;AAAA,EAClB,CAAC;AAGD,IAAE,SAAS,SAAS,WAAW,cAAc,uBAAuB;AAAA,IAClE,MAAM,aAAE,qCAAqC;AAAA,IAC7C,MAAM,aAAE,qCAAqC;AAAA,IAC7C,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,SAAS,EAAE,GAAG,0BAA0B;AAAA,IACxC,gBAAgB;AAAA,EAClB,CAAC;AAGD,IAAE,SAAS,SAAS,WAAW,cAAc,oBAAoB;AAAA,IAC/D,MAAM,aAAE,kCAAkC;AAAA,IAC1C,MAAM,aAAE,kCAAkC;AAAA,IAC1C,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,gBAAgB;AAAA,EAClB,CAAC;AAED,IAAE,SAAS,aAAa,WAAW,sBAAsB;AAAA,IACvD,MAAM,aAAE,gCAAgC;AAAA,IACxC,OAAO,aAAE,iCAAiC;AAAA,IAC1C,MAAM,aAAE,gCAAgC;AAAA,IACxC,MAAM;AAAA,IACN,MAAM;AAAA,IACN,YAAY;AAAA,EACd,CAAC;AACH;AAKO,SAAS,oBAAyC;AACvD,QAAM,IAAI;AACV,SAAO,EAAE,SAAS,IAAI,WAAW,cAAc,cAAc;AAC/D;AAKO,SAAS,qBAA8B;AAC5C,QAAM,IAAI;AACV,SAAO,EAAE,SAAS,IAAI,WAAW,cAAc,eAAe;AAChE;AAKO,SAAS,sBAA8B;AAC5C,QAAM,IAAI;AACV,SAAO,EAAE,SAAS,IAAI,WAAW,cAAc,gBAAgB;AACjE;AAEO,SAAS,2BAAkD;AAChE,QAAM,IAAI;AACV,QAAM,QAAQ,EAAE,SAAS,IAAI,WAAW,cAAc,qBAAqB;AAC3E,MAAI,CAAC,SAAS,OAAO,MAAM,UAAU,YAAY,OAAO,MAAM,WAAW,UAAU;AACjF,WAAO,EAAE,GAAG,0BAA0B;AAAA,EACxC;AAEA,SAAO,EAAE,OAAO,MAAM,OAAO,QAAQ,MAAM,OAAO;AACpD;AAEA,eAAsB,yBAAyB,MAA4C;AACzF,QAAM,IAAI;AACV,QAAM,EAAE,SAAS,IAAI,WAAW,cAAc,uBAAuB,IAAI;AAC3E;AAKO,SAAS,kBAAkB,MAAY,OAAuB;AAEnE,MAAI,KAAK,KAAM,QAAO;AAEtB,QAAM,aAAa,kBAAkB;AAGrC,MAAI,eAAe,KAAM,QAAO;AAGhC,MAAI,eAAe,WAAW;AAC5B,UAAM,YAAY,KAAK,QAAQ,MAAM,WAAW;AAChD,QAAI,CAAC,UAAW,QAAO;AAAA,EACzB;AAGA,MAAI,mBAAmB,GAAG;AACxB,UAAM,UAAU,MAAM,mBAAmB,MAAM,OAAO;AACtD,QAAI,CAAC,QAAS,QAAO;AAAA,EACvB;AAEA,SAAO;AACT;;;AMpKA;;;ACAA;AAGA;AAsBO,IAAM,cAAN,cAA0B,SAAS;AAAA,EAkBxC,YAAY,OAAc,SAAmC;AAC3D,UAAM,OAAO;AAjBf,SAAQ,eAAuB;AAC/B,SAAQ,YAAoB;AAC5B,SAAQ,OAAe;AACvB,SAAQ,OAAe;AACvB,SAAiB,WAAW;AAC5B,SAAiB,WAAW;AAC5B,SAAQ,YAAqB;AAC7B,SAAQ,kBAA0B;AAClC,SAAQ,kBAA0B;AAClC,SAAQ,YAAoB;AAC5B,SAAQ,YAAoB;AAC5B,SAAQ,WAAoB;AAC5B,SAAQ,oBAA6B;AAMnC,SAAK,QAAQ;AACb,SAAK,iBAAiB,yBAAyB;AAC/C,SAAK,0BAA0B,QAAQ,MAAM,SAAS,CAAC,SAAgC;AACrF,WAAK,iBAAiB;AACtB,WAAK,yBAAyB,IAAI;AAAA,IACpC,GAAG,GAAG;AAAA,EACR;AAAA,EAES,SAAiB;AACxB,WAAO;AAAA,EACT;AAAA,EAES,aAAiC;AACxC,WAAO,KAAK,MAAM,MAAM;AAAA,EAC1B;AAAA,EAEA,WAAoB,kBAAkC;AACpD,UAAM,OAAO,MAAM;AACnB,UAAM,EAAE,OAAO,OAAO,IAAI,yBAAyB;AACnD,WAAO;AAAA,MACL,GAAG;AAAA,MACH,IAAI;AAAA,MACJ,SAAS,CAAC,GAAI,KAAK,WAAW,CAAC,GAAI,cAAc;AAAA,MACjD,QAAQ;AAAA,QACN,GAAG,KAAK;AAAA,QACR,OAAO,aAAE,UAAU;AAAA,QACnB,MAAM;AAAA,QACN,WAAW;AAAA,QACX,aAAa;AAAA,MACf;AAAA,MACA,UAAU;AAAA,QACR,GAAG,KAAK;AAAA,QACR;AAAA,QACA;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EAEA,WAAoB,QAAgD;AAClE,UAAM,OAAO,MAAM;AACnB,WAAO;AAAA,MACL,GAAG;AAAA,MACH,SAAS;AAAA,QACP,GAAG,KAAK;AAAA,QACR,UAAU,WAAW,SAAS;AAAA,QAC9B,SAAS,CAAC,sBAAsB;AAAA,QAChC,YAAY,CAAC;AAAA,MACf;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,gBAAgB,SAAoG;AACxH,UAAM,cAAc,eAAe,KAAK,KAAK;AAC7C,UAAM,OAAO,KAAK;AAClB,UAAM,UAAU,kBAAkB,MAAM,KAAK,KAAK;AAClD,UAAM,mBAAmB,oBAAoB;AAE7C,UAAM,SAAS,mBAAmB;AAClC,UAAM,gBAAgB,OAAO,OAAO,CAAAG,WAAS,CAACA,OAAM,MAAM;AAC1D,UAAM,kBAAkB,cAAc,IAAI,CAAAA,WAASA,OAAM,EAAE;AAG3D,UAAM,SAAS,cAAc,IAAI,CAAAA,YAAU;AAAA,MACzC,GAAGA;AAAA,MACH,SAAS,YAAYA,OAAM,EAAE,MAAM;AAAA,IACrC,EAAE;AAEF,WAAO;AAAA,MACL,OAAO,KAAK;AAAA,MACZ,WAAW,KAAK,MAAM,QAAQ;AAAA,MAC9B,SAAS,KAAK,MAAM,MAAM;AAAA,MAC1B;AAAA,MACA,cAAc,mBAAmB,KAAK,OAAO,eAAe;AAAA,MAC5D,YAAY,gBAAgB;AAAA,MAC5B;AAAA,MACA;AAAA,MACA,mBAAmB,aAAE,sBAAsB;AAAA,IAC7C;AAAA,EACF;AAAA,EAEA,MAAM,UAAU,SAA0C,SAAyD;AACjH,UAAM,MAAM,UAAU,SAAS,OAAO;AAEtC,UAAM,UAAU,KAAK;AACrB,QAAI,CAAC,QAAS;AAGd,UAAM,eAAe,QAAQ,cAA2B,uBAAuB;AAG/E,UAAM,aAAa,QAAQ,iBAA8B,aAAa;AACtE,YAAQ,IAAI,qCAAqC,WAAW,MAAM;AAElE,QAAI,cAAc;AAChB,mBAAa,iBAAiB,SAAS,CAAC,MAAkB;AACxD,YAAI,KAAK,mBAAmB;AAC1B,eAAK,oBAAoB;AACzB;AAAA,QACF;AAEA,cAAM,cAAc,KAAK,sBAAsB,GAAG,cAAc,UAAU;AAC1E,YAAI,aAAa;AACf,kBAAQ,IAAI,wCAAwC,YAAY,QAAQ,OAAO;AAC/E,eAAK,cAAc,GAAG,WAAW;AAAA,QACnC;AAAA,MACF,CAAC;AAED,mBAAa;AAAA,QACX;AAAA,QACA,CAAC,MAAkB;AACjB,YAAE,eAAe;AACjB,eAAK,WAAW,GAAG,YAAY;AAAA,QACjC;AAAA,QACA,EAAE,SAAS,MAAM;AAAA,MACnB;AAEA,YAAM,WAAW,CAAC,MAAoB;AACpC,YAAI,CAAC,KAAK,UAAW;AAErB,aAAK,YAAY;AACjB,qBAAa,UAAU,OAAO,SAAS;AAEvC,YAAI;AACF,uBAAa,sBAAsB,EAAE,SAAS;AAAA,QAChD,QAAQ;AAAA,QAER;AAEA,YAAI,KAAK,SAAU,MAAK,oBAAoB;AAAA,MAC9C;AAEA,mBAAa,iBAAiB,eAAe,CAAC,MAAoB;AAChE,YAAI,EAAE,WAAW,EAAG;AAEpB,cAAM,SAAS,EAAE;AACjB,YAAI,QAAQ,UAAU,aAAa,EAAG;AAEtC,UAAE,eAAe;AAEjB,aAAK,YAAY;AACjB,aAAK,WAAW;AAChB,aAAK,kBAAkB,EAAE;AACzB,aAAK,kBAAkB,EAAE;AACzB,aAAK,YAAY,KAAK;AACtB,aAAK,YAAY,KAAK;AAEtB,qBAAa,UAAU,IAAI,SAAS;AACpC,qBAAa,kBAAkB,EAAE,SAAS;AAAA,MAC5C,CAAC;AAED,mBAAa,iBAAiB,eAAe,CAAC,MAAoB;AAChE,YAAI,CAAC,KAAK,UAAW;AAErB,UAAE,eAAe;AAEjB,cAAM,KAAK,EAAE,UAAU,KAAK;AAC5B,cAAM,KAAK,EAAE,UAAU,KAAK;AAE5B,YAAI,CAAC,KAAK,YAAY,KAAK,MAAM,IAAI,EAAE,IAAI,EAAG,MAAK,WAAW;AAE9D,aAAK,OAAO,KAAK,YAAY;AAC7B,aAAK,OAAO,KAAK,YAAY;AAC7B,aAAK,WAAW,YAAY;AAAA,MAC9B,CAAC;AAED,mBAAa,iBAAiB,aAAa,QAAQ;AACnD,mBAAa,iBAAiB,iBAAiB,QAAQ;AAEvD,YAAM,WAAY,QAA+B;AACjD,UAAI,UAAU;AACZ,qBAAa,MAAM,kBAAkB,QAAQ,QAAQ;AAAA,MACvD;AAEA,WAAK,WAAW,YAAY;AAE5B,YAAM,WAAW,QAAQ,cAAiC,mBAAmB;AAC7E,UAAI,UAAU;AACZ,iBAAS,iBAAiB,SAAS,OAAK;AACtC,YAAE,eAAe;AACjB,eAAK,WAAW,YAAY;AAAA,QAC9B,CAAC;AAAA,MACH;AAAA,IACF;AAGA,UAAM,cAAc,QAAQ,cAAgC,sBAAsB;AAClF,QAAI,aAAa;AACf,kBAAY,QAAQ,KAAK;AACzB,kBAAY,iBAAiB,SAAS,CAAC,MAAa,KAAK,eAAe,GAAG,WAAW,CAAC;AAAA,IACzF;AAGA,QAAI,KAAK,cAAc;AACrB,WAAK,mBAAmB;AAAA,IAC1B;AAAA,EACF;AAAA,EAEmB,YAAY,SAAgD;AAC7E,UAAM,YAAY,OAAO;AAEzB,QAAI,KAAK,UAAW;AAEpB,UAAM,EAAE,OAAO,OAAO,IAAI,KAAK;AAC/B,QAAI,OAAO,UAAU,YAAY,OAAO,WAAW,SAAU;AAE7D,UAAM,WAAW,EAAE,OAAO,KAAK,MAAM,KAAK,GAAG,QAAQ,KAAK,MAAM,MAAM,EAAE;AACxE,QAAI,SAAS,SAAS,KAAK,SAAS,UAAU,EAAG;AACjD,QAAI,SAAS,UAAU,KAAK,eAAe,SAAS,SAAS,WAAW,KAAK,eAAe,OAAQ;AAEpG,SAAK,wBAAwB,QAAQ;AAAA,EACvC;AAAA,EAEA,MAAc,cAAc,OAAc,MAAkC;AAC1E,UAAM,eAAe;AACrB,UAAM,gBAAgB;AAEtB,UAAM,UAAU,KAAK,QAAQ;AAC7B,YAAQ,IAAI,iDAAiD,OAAO;AACpE,QAAI,CAAC,QAAS;AAEd,UAAM,OAAO,KAAK;AAClB,UAAM,UAAU,kBAAkB,MAAM,KAAK,KAAK;AAClD,YAAQ,IAAI,2BAA2B,SAAS,cAAc,KAAK,IAAI;AAEvE,QAAI,CAAC,SAAS;AACZ,aAAO,KAAK,aAAE,4BAA4B,CAAC;AAC3C;AAAA,IACF;AAEA,UAAM,gBAAgB,eAAe,KAAK,KAAK;AAC/C,UAAM,iBAAiB,cAAc,OAAO,MAAM;AAClD,UAAM,aAAa,CAAC;AAGpB,SAAK,kBAAkB,MAAM,UAAU;AAEvC,QAAI;AACF,UAAI,KAAK,MAAM;AAEb,cAAM,iBAAiB,KAAK,OAAO,SAAS,YAAY,KAAK,MAAM,MAAS;AAE5E,oBAAY,EAAE,MAAM,gBAAgB,KAAK,KAAK,MAAM,MAAM,QAAW,QAAQ,gBAAgB,GAAG,EAAE,aAAa,MAAM,CAAC;AAAA,MACxH,OAAO;AAEL,cAAM,UAAU,MAAM,mBAAmB,KAAK,MAAM,MAAM,IAAI,SAAS,UAAU;AACjF,YAAI,CAAC,SAAS;AAEZ,eAAK,kBAAkB,MAAM,cAAc;AAC3C,iBAAO,MAAM,aAAE,4BAA4B,CAAC;AAC5C;AAAA,QACF;AAAA,MACF;AAGA,WAAK,eAAe;AAAA,IACtB,SAAS,KAAK;AACZ,cAAQ,MAAM,0CAA0C,GAAG;AAE3D,WAAK,kBAAkB,MAAM,cAAc;AAC3C,aAAO,MAAM,aAAE,4BAA4B,CAAC;AAAA,IAC9C;AAAA,EACF;AAAA,EAEQ,gBAAgB,OAAsB,MAAyB;AACrE,QAAI,MAAM,QAAQ,WAAW,MAAM,QAAQ,KAAK;AAC9C,YAAM,eAAe;AACrB,WAAK,cAAc,OAAO,IAAI;AAAA,IAChC;AAAA,EACF;AAAA,EAEQ,eAAe,OAAc,OAA+B;AAClE,SAAK,eAAe,MAAM,MAAM,YAAY,EAAE,KAAK;AACnD,SAAK,mBAAmB;AAAA,EAC1B;AAAA,EAEQ,qBAA2B;AACjC,UAAM,UAAU,KAAK;AACrB,QAAI,CAAC,QAAS;AAEd,UAAM,QAAQ,QAAQ,iBAA8B,aAAa;AACjE,UAAM,cAAc,KAAK,aAAa,YAAY;AAElD,UAAM,QAAQ,UAAQ;AACpB,YAAM,YAAY,KAAK,QAAQ,WAAW,YAAY,KAAK;AAC3D,YAAM,UAAU,gBAAgB,MAAM,UAAU,SAAS,WAAW;AAEpE,UAAI,SAAS;AACX,aAAK,UAAU,OAAO,eAAe;AACrC,aAAK,UAAU,IAAI,cAAc;AAAA,MACnC,OAAO;AACL,aAAK,UAAU,IAAI,eAAe;AAClC,aAAK,UAAU,OAAO,cAAc;AAAA,MACtC;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EAEQ,kBAAkB,MAAmB,SAAwB;AACnE,QAAI,SAAS;AACX,WAAK,UAAU,IAAI,SAAS;AAC5B,WAAK,UAAU,OAAO,UAAU;AAChC,WAAK,aAAa,gBAAgB,MAAM;AAAA,IAC1C,OAAO;AACL,WAAK,UAAU,OAAO,SAAS;AAC/B,WAAK,UAAU,IAAI,UAAU;AAC7B,WAAK,aAAa,gBAAgB,OAAO;AAAA,IAC3C;AAAA,EACF;AAAA,EAEQ,iBAAuB;AAC7B,UAAM,UAAU,KAAK;AACrB,QAAI,CAAC,QAAS;AAEd,UAAM,UAAU,QAAQ,cAA2B,gBAAgB;AACnE,QAAI,SAAS;AACX,YAAM,kBAAkB,mBAAmB,EACxC,OAAO,CAAAA,WAAS,CAACA,OAAM,MAAM,EAC7B,IAAI,CAAAA,WAASA,OAAM,EAAE;AACxB,YAAM,QAAQ,mBAAmB,KAAK,OAAO,eAAe;AAC5D,cAAQ,cAAc,GAAG,KAAK,MAAM,gBAAgB,MAAM;AAAA,IAC5D;AAAA,EACF;AAAA,EAEQ,sBAAsB,OAAmB,WAAwB,OAAoD;AAC3H,UAAM,gBAAgB,UAAU,sBAAsB;AACtD,UAAM,SAAS,MAAM,UAAU,cAAc;AAC7C,UAAM,SAAS,MAAM,UAAU,cAAc;AAE7C,UAAM,YAAY,SAAS,KAAK,QAAQ,KAAK;AAC7C,UAAM,YAAY,SAAS,KAAK,QAAQ,KAAK;AAE7C,UAAM,YAAY,KAAK,KAAK;AAE5B,eAAW,QAAQ,OAAO;AACxB,YAAM,cAAc,WAAW,KAAK,MAAM,IAAI,IAAI;AAClD,YAAM,aAAa,WAAW,KAAK,MAAM,GAAG,IAAI;AAEhD,YAAM,QAAQ,cAAc,cAAc;AAC1C,YAAM,QAAQ,aAAa,cAAc;AAEzC,YAAM,WAAW,KAAK,KAAK,KAAK,IAAI,WAAW,OAAO,CAAC,IAAI,KAAK,IAAI,WAAW,OAAO,CAAC,CAAC;AAExF,UAAI,YAAY,UAAW,QAAO;AAAA,IACpC;AAEA,WAAO;AAAA,EACT;AAAA,EAEQ,WAAW,OAAmB,WAA8B;AAClE,UAAM,gBAAgB,UAAU,sBAAsB;AACtD,UAAM,SAAS,MAAM,UAAU,cAAc;AAC7C,UAAM,SAAS,MAAM,UAAU,cAAc;AAE7C,UAAM,UAAU,KAAK;AACrB,UAAM,SAAS,MAAM,SAAS,IAAI,MAAM;AACxC,UAAM,WAAW,UAAU;AAC3B,UAAM,UAAU,KAAK,IAAI,KAAK,UAAU,KAAK,IAAI,KAAK,UAAU,QAAQ,CAAC;AAEzE,QAAI,YAAY,QAAS;AAEzB,UAAM,YAAY,SAAS,KAAK,QAAQ;AACxC,UAAM,YAAY,SAAS,KAAK,QAAQ;AAExC,SAAK,YAAY;AACjB,SAAK,OAAO,SAAS,WAAW;AAChC,SAAK,OAAO,SAAS,WAAW;AAEhC,SAAK,WAAW,SAAS;AAAA,EAC3B;AAAA,EAEQ,WAAW,WAA8B;AAC/C,UAAM,UAAU,UAAU,cAA2B,qBAAqB;AAC1E,QAAI,CAAC,QAAS;AAEd,YAAQ,MAAM,YAAY,aAAa,KAAK,IAAI,OAAO,KAAK,IAAI,aAAa,KAAK,SAAS;AAC3F,YAAQ,MAAM,kBAAkB;AAAA,EAClC;AAAA,EAEQ,WAAW,WAA8B;AAC/C,SAAK,YAAY;AACjB,SAAK,OAAO;AACZ,SAAK,OAAO;AACZ,SAAK,WAAW,SAAS;AAAA,EAC3B;AAAA,EAEA,MAAyB,cAAc,IAAiC;AAEtE,UAAM,KAAK,OAAO,IAAI;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,WAAkB;AAChB,WAAO,KAAK;AAAA,EACd;AACF;AAKO,SAAS,gBAAgB,OAAoB;AAClD,QAAM,MAAM,IAAI,YAAY,KAAK;AACjC,MAAI,OAAO,IAAI;AACjB;;;AD9bA;AAMO,SAAS,2BAAiC;AAE/C,QAAM,GAAG,8BAA8B,CAAC,OAAY,YAAmB;AACrE,UAAM,QAAQ,MAAM,SAAS,MAAM;AACnC,QAAI,CAAC,MAAO;AAEZ,YAAQ,QAAQ;AAAA,MACd,OAAO,aAAE,iBAAiB;AAAA,MAC1B,OAAO;AAAA,MACP,MAAM;AAAA,MACN,SAAS,MAAM,gBAAgB,KAAK;AAAA,IACtC,CAAC;AAAA,EACH,CAAC;AAGD,EAAC,MAAc,GAAG,iCAAiC,CAAC,KAAU,aAAoB;AAChF,UAAM,QAAQ,IAAI,SAAS,IAAI;AAC/B,QAAI,CAAC,MAAO;AAEZ,aAAS,QAAQ;AAAA,MACf,OAAO,aAAE,iBAAiB;AAAA,MAC1B,OAAO;AAAA,MACP,MAAM;AAAA,MACN,SAAS,MAAM,gBAAgB,KAAK;AAAA,IACtC,CAAC;AAAA,EACH,CAAC;AACH;;;AElCA;AACA;AAUO,SAAS,sBAA4B;AAC1C,MAAI,CAAC,KAAK,MAAM,KAAM;AAEtB,QAAM,YAAY,aAAa;AAC/B,QAAM,KAAK,UAAU;AAGrB,KAAG,GAAG,mBAAmB,OAAM,QAAO;AACpC,qBAAiB;AAEjB,UAAM,UAAU,IAAI;AACpB,UAAM,EAAE,SAAS,SAAS,QAAQ,IAAI;AAGtC,UAAM,QAAQ,KAAK,QAAQ,IAAI,OAAO;AACtC,QAAI,CAAC,OAAO;AACV,cAAQ,KAAK,wBAAwB,OAAO,YAAY;AACxD,aAAO,EAAE,SAAS,OAAO,SAAS,SAAS,SAAS,MAAM;AAAA,IAC5D;AAGA,UAAM,iBAAiB,KAAK,OAAO,IAAI,IAAI,MAAM;AACjD,QAAI,kBAAkB,CAAC,kBAAkB,gBAAgB,KAAK,GAAG;AAC/D,cAAQ,KAAK,uBAAuB,IAAI,MAAM,uCAAuC,OAAO,EAAE;AAC9F,aAAO,EAAE,SAAS,OAAO,SAAS,SAAS,SAAS,MAAM;AAAA,IAC5D;AAEA,QAAI;AAEF,YAAM,iBAAiB,OAAO,SAAS,SAAS,IAAI,MAAM;AAG1D,kBAAY,EAAE,MAAM,gBAAgB,KAAK,SAAS,QAAQ,gBAAgB,GAAG,EAAE,aAAa,KAAK,CAAC;AAGlG,kBAAY,EAAE,MAAM,uBAAuB,KAAK,SAAS,QAAQ,gBAAgB,GAAG,EAAE,aAAa,KAAK,CAAC;AAEzG,aAAO,EAAE,SAAS,MAAM,SAAS,SAAS,QAAQ;AAAA,IACpD,SAAS,KAAK;AACZ,cAAQ,MAAM,0CAA0C,GAAG;AAC3D,aAAO,EAAE,SAAS,OAAO,SAAS,SAAS,SAAS,MAAM;AAAA,IAC5D;AAAA,EACF,CAAC;AAGD,KAAG,GAAG,iBAAiB,OAAM,QAAO;AAClC,UAAM,UAAU,IAAI;AACpB,UAAM,EAAE,QAAQ,IAAI;AAEpB,UAAM,QAAQ,KAAK,QAAQ,IAAI,OAAO;AACtC,QAAI,CAAC,OAAO;AACV,cAAQ,KAAK,wBAAwB,OAAO,YAAY;AACxD,aAAO,EAAE,SAAS,QAAQ,CAAC,EAAE;AAAA,IAC/B;AAEA,UAAM,SAAS,eAAe,KAAK;AACnC,WAAO,EAAE,SAAS,OAAO;AAAA,EAC3B,CAAC;AAGD,KAAG,GAAG,iBAAiB,OAAM,QAAO;AAClC,qBAAiB;AAEjB,UAAM,UAAU,IAAI;AACpB,UAAM,EAAE,SAAS,OAAO,IAAI;AAE5B,UAAM,QAAQ,KAAK,QAAQ,IAAI,OAAO;AACtC,QAAI,CAAC,OAAO;AACV,cAAQ,KAAK,wBAAwB,OAAO,YAAY;AACxD,aAAO,EAAE,SAAS,MAAM;AAAA,IAC1B;AAGA,UAAM,iBAAiB,KAAK,OAAO,IAAI,IAAI,MAAM;AACjD,QAAI,kBAAkB,CAAC,kBAAkB,gBAAgB,KAAK,GAAG;AAC/D,cAAQ,KAAK,uBAAuB,IAAI,MAAM,uCAAuC,OAAO,EAAE;AAC9F,aAAO,EAAE,SAAS,MAAM;AAAA,IAC1B;AAEA,QAAI;AACF,YAAM,EAAE,gBAAAC,gBAAe,IAAI,MAAM;AACjC,YAAMA,gBAAe,OAAO,QAAQ,IAAI,MAAM;AAG9C,kBAAY,EAAE,MAAM,gBAAgB,KAAK,SAAS,QAAQ,iBAAiB,GAAG,EAAE,aAAa,KAAK,CAAC;AAEnG,kBAAY,EAAE,MAAM,uBAAuB,KAAK,SAAS,QAAQ,iBAAiB,GAAG,EAAE,aAAa,KAAK,CAAC;AAE1G,aAAO,EAAE,SAAS,KAAK;AAAA,IACzB,SAAS,KAAK;AACZ,cAAQ,MAAM,wCAAwC,GAAG;AACzD,aAAO,EAAE,SAAS,MAAM;AAAA,IAC1B;AAAA,EACF,CAAC;AAED,UAAQ,IAAI,2CAA2C;AACzD;;;ATpGA,IAAI;AAEJ,MAAM,GAAG,QAAQ,MAAM;AAErB,mBAAiB,IAAI,sBAAsB,OAAO;AAClD,iBAAe,KAAK;AAGpB,4BAA0B;AAG1B,QAAM,KAAM,WAAmB;AAC/B,MAAI,MAAM,CAAC,GAAG,SAAS,UAAU;AAC/B,OAAG,eAAe,YAAY,CAAC,GAAW,MAAc;AACtD,cAAQ,OAAO,CAAC,KAAK,MAAM,OAAO,CAAC,KAAK;AAAA,IAC1C,CAAC;AAAA,EACH;AAGA,mBAAiB;AAGjB,QAAM,SAAS,UAAU;AACzB,MAAI,QAAQ;AACV,WAAO,MAAM;AAAA,MACX;AAAA,IACF;AAAA,EACF;AAGA,QAAM,aAAa,qBAAqB;AACxC,MAAI,CAAC,WAAW,OAAO;AACrB,YAAQ,MAAM,mDAAmD,WAAW,MAAM;AAAA,EACpF;AAEA,UAAQ,IAAI,gCAAgC;AAC9C,CAAC;AAED,MAAM,KAAK,SAAS,MAAM;AAExB,sBAAoB;AAGpB,2BAAyB;AAEzB,UAAQ,IAAI,0BAA0B;AACxC,CAAC;AAGD,OAAO,iBAAiB,gBAAgB,MAAM;AAC5C,kBAAgB,QAAQ;AAC1B,CAAC;",
  "names": ["plane", "plane", "plane", "dx", "dy", "plane", "setActorPlanes"]
}
